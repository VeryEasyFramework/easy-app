var Y=Object.defineProperty;var Z=(i,t,e)=>t in i?Y(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var P=(i,t,e)=>Z(i,typeof t!="symbol"?t+"":t,e);import{_ as ee}from"./ListDetailLayout.vue_vue_type_style_index_0_lang-C1gclSHL.js";import{d,o as l,p as u,t as p,_ as M,B as G,b as r,v as j,D as te,a as g,x as T,e as L,c as C,w as _,C as D,F as S,z as B,E as ie,l as k,G as O,s as J,h as K,H as se,j as ne,A as ae,I as le,J as oe,K as re,T as ce}from"./index-hlzIjE76.js";import{C as W}from"./CardWidget-Cv_RxGrY.js";import{_ as ue,a as b}from"./index-Bc-B_4EF.js";import{M as V,_ as z}from"./ButtonIcon.vue_vue_type_script_setup_true_lang-DedLdgYS.js";import{_ as de,a as fe}from"./TransitionList.vue_vue_type_style_index_0_lang-en7sij_f.js";import{l as pe,_ as _e}from"./ModalView.vue_vue_type_style_index_0_lang-DKM3DQX9.js";import{_ as me}from"./EasyInput.vue_vue_type_script_setup_true_lang-4Hy4SXhy.js";import"./Button.vue_vue_type_script_setup_true_lang-BEx5Lo2r.js";import"./InputData.vue_vue_type_script_setup_true_lang-DfK0UIer.js";const ve={class:"data-field"},ye=d({__name:"DisplayData",props:{value:{},field:{}},setup(i){const t=i;return(e,s)=>(l(),u("div",ve,p(t.value),1))}}),U=M(ye,[["__scopeId","data-v-565ecf45"]]),he={class:"int-field"},ge=d({__name:"DisplayInt",props:{value:{},field:{}},setup(i){const t=i,e=G(()=>t.value==null?"":t.value);return(s,a)=>(l(),u("div",he,p(e.value),1))}}),Le=d({__name:"DisplayBigInt",props:{value:{},field:{}},setup(i){const t=i;return(e,s)=>(l(),u("div",null,p(t.value),1))}}),Ie=d({__name:"DisplayDate",props:{value:{},field:{}},setup(i){const t=i;return(e,s)=>(l(),u("div",null,p(t.value),1))}}),we=d({__name:"DisplayBoolean",props:{value:{},field:{}},setup(i){return(t,e)=>(l(),u("div",{class:j(["boolean-field",{true:t.value}])},[r(V,{class:"icon",icon:t.value?"check":"close",size:"0.6"},null,8,["icon"])],2))}}),$e=d({__name:"DisplayPassword",props:{value:{},field:{}},setup(i){const t=i;return(e,s)=>(l(),u("div",null,p(t.value),1))}}),Fe=d({__name:"DisplayMultiChoice",props:{value:{},field:{}},setup(i){const t=i;return(e,s)=>(l(),u("div",null,p(t.value),1))}}),ke={class:"text-field"},De=d({__name:"DisplayText",props:{value:{},field:{}},setup(i){const t=i;return(e,s)=>(l(),u("div",ke,p(t.value),1))}}),Ce=d({__name:"DisplayEmail",props:{value:{},field:{}},setup(i){const t=i;return(e,s)=>(l(),u("div",null,p(t.value),1))}}),Ee=d({__name:"DisplayImage",props:{value:{},field:{}},setup(i){const t=i;return(e,s)=>(l(),u("div",null,p(t.value),1))}}),Pe=d({__name:"DisplayPhone",props:{value:{},field:{}},setup(i){const t=i;return(e,s)=>(l(),u("div",null,p(t.value),1))}}),Te=d({__name:"DisplayConnection",props:{value:{},routePrefix:{},field:{},titleValue:{}},setup(i){const t=te();async function e(){const s=`${i.routePrefix}/${i.value}`;await t.push(s)}return(s,a)=>(l(),u("div",{class:"connection-field",onClick:e},p(s.titleValue||s.value),1))}}),xe={class:"decimal-field"},be=d({__name:"DisplayDecimal",props:{value:{},field:{}},setup(i){const t=i,e=G(()=>t.value==null?"":parseFloat(t.value).toFixed(2));return(s,a)=>(l(),u("div",xe,p(e.value),1))}}),Ve={class:"url-field"},ze=["href"],Me=d({__name:"DisplayURL",props:{value:{},field:{}},setup(i){const t=i,e=g();return T(()=>{if(t.value)try{e.value=new URL(t.value)}catch{}}),(s,a)=>{var w,I;return l(),u("div",Ve,[L("a",{href:(w=e.value)==null?void 0:w.href,target:"_blank"},p((I=e.value)==null?void 0:I.href),9,ze)])}}}),Se=M(Me,[["__scopeId","data-v-7506a7d2"]]),Be=d({__name:"DisplayRichText",props:{value:{}},setup(i){return(t,e)=>(l(),u("div",null,p(t.value),1))}}),Ae={IDField:U,DataField:U,IntField:ge,BigIntField:Le,DateField:Ie,BooleanField:we,PasswordField:$e,ChoicesField:de,MultiChoiceField:Fe,TextField:De,EmailField:Ce,ImageField:Ee,JSONField:ue,PhoneField:Pe,ConnectionField:Te,TimeStampField:b,DecimalField:be,URLField:Se,RichTextField:Be},Ne={class:"text-small text-primary bold item-label"},Re={class:"text-small italic text-primary-bright"},Oe=d({__name:"EntityListItem",props:{entityDef:{},record:{},active:{type:Boolean},fields:{}},emits:["select"],setup(i,{emit:t}){return(e,s)=>(l(),C(W,{class:j(["full-width entity-list-item position-relative",{active:e.active}]),onClick:s[0]||(s[0]=a=>e.$emit("select",e.record.id))},{default:_(()=>[r(D,{class:"row shrink"},{default:_(()=>[r(D,{class:"col shrink horizontal-align-between"},{default:_(()=>[L("div",Ne,p(e.record[e.entityDef.config.titleField||"id"]),1)]),_:1}),r(D,{class:"col shrink"},{default:_(()=>[(l(!0),u(S,null,B(e.fields,a=>(l(),u("div",{key:a.key},[L("div",Re,[(l(),C(ie(k(Ae)[a.fieldType]),{field:a,format:"date",routePrefix:`/entity/${a.connectionEntity}`,value:e.record[a.key],titleValue:a.connectionTitleField?e.record[a.connectionTitleField]:""},null,8,["field","routePrefix","value","titleValue"]))])]))),128))]),_:1})]),_:1}),r(D,{class:"gap-2 pe-2 pt-1 dates col shrink position-absolute top right"},{default:_(()=>[r(D,{class:"col shrink text-tiny italic overflow-visible"},{default:_(()=>[r(V,{icon:"add",size:"0.6"}),r(b,{value:e.record.createdAt,format:"compact"},null,8,["value"])]),_:1}),r(D,{class:"col shrink text-tiny italic overflow-visible"},{default:_(()=>[r(V,{icon:"update",size:"0.6"}),r(b,{value:e.record.updatedAt,format:"compact"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["class"]))}}),Ue={class:"title-3"},qe=d({__name:"NewEntityForm",props:{entityDef:{}},emits:["close"],setup(i,{emit:t}){function e(){E("close")}async function s(){if(!w())return;await K.createEntity(I.entityDef.entityId,m.value)&&e()}let a=[];function w(){let o=!0;return y.value={},a.forEach($=>{m.value[$.key]||(y.value[$.key]="This field is required.",o=!1)}),o}const I=i,m=g({}),y=g({}),E=t;return pe(o=>{o.key==="Escape"&&e(),o.key==="Enter"&&s()}),T(()=>{a=I.entityDef.fields.filter(o=>o.required),a.forEach(o=>{o.defaultValue&&(m.value[o.key]=o.defaultValue)})}),(o,$)=>(l(),C(J,{class:"row-gap-4"},{default:_(()=>[L("div",Ue," New "+p(o.entityDef.config.label),1),L("form",{onSubmit:$[0]||($[0]=O(()=>{},["prevent"]))},[r(D,{class:"col-2 row-gap-4 column-gap-3"},{default:_(()=>[(l(!0),u(S,null,B(o.entityDef.fields.filter(v=>v.required),(v,F)=>(l(),C(me,{focus:F==0,field:v,error:y.value[v.key],modelValue:m.value[v.key],"onUpdate:modelValue":x=>m.value[v.key]=x,key:v.key},null,8,["focus","field","error","modelValue","onUpdate:modelValue"]))),128))]),_:1})],32),r(D,{class:"col shrink horizontal-align-center"},{default:_(()=>[r(z,{onClick:e,icon:"close",color:"error",size:"1"}),r(z,{type:"submit",onClick:O(s,["prevent"]),icon:"check",color:"success",size:"1"})]),_:1})]),_:1}))}});class He{constructor(){P(this,"initialized");P(this,"entity");P(this,"listInfo");P(this,"entityList");P(this,"isListLoading",!1);P(this,"listOptions");P(this,"easyApi");this.easyApi=K,this.initialized=!1,this.entityList=g([]),this.listOptions={offset:0},this.listInfo={totalCount:g(0),itemsLoaded:g(0),itemsPerPage:0,listHeight:g(0),limitStart:0,resetScroll:g(!1),currentPage:1}}async init(t){var e;((e=this.entity)==null?void 0:e.entityId)==t.entityId&&(this.entityList.value=[],this.listOptions.columns=t.listFields,this.listOptions.orderBy=t.config.orderField||"updatedAt",this.listOptions.order=t.config.orderDirection||"desc",this.entity=t,this.initialized||(this.initialized=!0))}reset(){this.entityList.value=[],this.listInfo.totalCount.value=0,this.listInfo.itemsLoaded.value=0,this.listInfo.currentPage=1,this.listInfo.limitStart=0}async loadList(){if(!this.isListLoading){this.isListLoading=!0;const{data:t,columns:e,rowCount:s,totalCount:a}=await this.easyApi.getList(this.entity.entityId,{...this.listOptions,offset:this.listInfo.limitStart,limit:this.listInfo.itemsPerPage});this.entityList.value.push(...t),this.listInfo.totalCount.value=a,this.listInfo.itemsLoaded.value=s,this.isListLoading=!1,this.listInfo.resetScroll.value=!0}}async loadMore(t){if(!(this.listInfo.itemsLoaded.value>=this.listInfo.totalCount.value)&&!this.isListLoading){this.isListLoading=!0;const e=this.entityList.value.length,s=t-e+this.listInfo.itemsPerPage,{data:a,columns:w,rowCount:I,totalCount:m}=await this.easyApi.getList(this.entity.entityId,{...this.listOptions,offset:e,limit:s});this.entityList.value.push(...a),this.listInfo.totalCount.value=m,this.listInfo.itemsLoaded.value=this.entityList.value.length,this.listInfo.currentPage=Math.floor(this.entityList.value.length/this.listInfo.itemsPerPage),this.isListLoading=!1}}}const Ge={class:"position-relative input"},je=d({__name:"EntitySearchInput",props:{entity:{}},emits:["search"],setup(i,{emit:t}){const e=i;let s=[];const a=["DataField","EmailField","TextField","IntField","PhoneField"];T(()=>{if(!e.entity)throw new Error("EntitySearchInput requires an entity prop");s=e.entity.fields.filter(m=>a.includes(m.fieldType))});const w=t;function I(m){const y=m.target.value,E={};s.forEach(o=>{const $=o.fieldType;let v="contains";if($==="IntField"){const F=parseInt(y);if(isNaN(F))return;v="=",E[o.key]={op:v,value:F};return}E[o.key]={op:v,value:y}}),w("search",E)}return(m,y)=>(l(),u("div",Ge,[L("input",{type:"search",placeholder:"Type to search...",onInput:I},null,32)]))}}),Je={class:"title-3"},Ke={class:"label text-end"},We={class:"grid standard-grid-no-padding list-wrapper"},q=3,H=60,Qe=d({__name:"EntityList",props:{entity:{},activeEntity:{}},emits:["select"],setup(i,{emit:t}){se(n=>({"0b963782":x,"0aeb6a7e":$,"60ebd5bc":v.value}));const e=new He,s=i;let a=g();function w(){y.value=!0}function I(){y.value=!1}function m(n){e.listOptions.orFilter=n,e.loadList()}const y=g(!1);let E=[];ne(async()=>{const n=ae.entities.find(f=>f.entityId===s.entity);if(!n)return;a.value=n,e.entity=n;const c=n.fields.filter(f=>f.connectionTitleField).map(f=>f.connectionTitleField);E=n.fields.filter(f=>!n.listFields.includes(f.key)||["id","createdAt","updatedAt",n.config.titleField].includes(f.key)?!1:!c.includes(f.key))}),le(s.entity);const o=oe("infinite"),$=`${q}px`,v=g("0"),F=H+q,x=`${H}px`;T(async()=>{var c;await e.init(a.value);const n=(c=o.value)==null?void 0:c.parentElement;n&&await R(n),window.addEventListener("resize",N),n==null||n.addEventListener("scroll",A)}),re(()=>{var c;const n=(c=o.value)==null?void 0:c.parentElement;n==null||n.removeEventListener("scroll",A),window.removeEventListener("resize",N)});async function A(n){const f=n.currentTarget.scrollTop,h=Math.floor(f/F+e.listInfo.itemsPerPage);h+3>e.listInfo.itemsLoaded.value&&(await e.loadMore(h),setTimeout(Q,500))}async function Q(){var f,h;const n=(h=(f=o.value)==null?void 0:f.parentElement)==null?void 0:h.scrollTop;let c=Math.floor(n/F+e.listInfo.itemsPerPage);c>e.listInfo.totalCount.value&&(c=e.listInfo.totalCount.value),c>e.listInfo.itemsLoaded.value&&await e.loadMore(c)}async function N(){var n;await R((n=o.value)==null?void 0:n.parentElement)}async function R(n){const c=n.getBoundingClientRect(),f=Math.floor(c.height/F);e.listInfo.itemsPerPage=f*2,n.scrollTop=0,e.reset(),await e.loadList(),v.value=`${e.listInfo.totalCount.value*F}px`}return(n,c)=>(l(),C(J,{class:"entity-list-wrapper"},{default:_(()=>{var f;return[L("div",Je,p((f=k(a))==null?void 0:f.config.label),1),r(W,null,{default:_(()=>[r(D,{class:"list-header col horizontal-align-between"},{default:_(()=>[r(je,{entity:k(a),onSearch:m},null,8,["entity"]),L("div",null,[r(z,{label:`New ${n.entity}`,onClick:w,icon:"add",size:"1"},null,8,["label"])])]),_:1})]),_:1}),L("div",Ke," Loaded "+p(k(e).listInfo.itemsLoaded)+" of "+p(k(e).listInfo.totalCount)+" records ",1),L("div",We,[L("div",{ref_key:"infinite",ref:o,class:"grid standard-grid-no-padding list-container row infinite overflow-hidden"},[r(fe,{fade:""},{default:_(()=>[(l(!0),u(S,null,B(k(e).entityList.value,h=>(l(),C(Oe,{active:n.activeEntity==h.id,key:h.id,entityDef:k(a),fields:k(E),record:h,onSelect:c[0]||(c[0]=X=>n.$emit("select",X))},null,8,["active","entityDef","fields","record"]))),128))]),_:1})],512)]),r(_e,{modelValue:y.value,"onUpdate:modelValue":c[1]||(c[1]=h=>y.value=h)},{default:_(()=>[r(qe,{entityDef:k(e).entity,onClose:I},null,8,["entityDef"])]),_:1},8,["modelValue"])]}),_:1}))}}),Xe=d({__name:"EntityListView",props:{entity:{},id:{}},setup(i){const t=i;return(e,s)=>(l(),C(ee,{maxWidth:"300px"},{list:_(()=>[(l(),C(Qe,{entity:e.entity,activeEntity:e.id,onSelect:s[0]||(s[0]=a=>e.$router.push(`/entity/${e.entity}/${a}`)),key:e.entity},null,8,["entity","activeEntity"]))]),detail:_(()=>[(l(),C(ce,{key:t.id}))]),_:1}))}}),ct=M(Xe,[["__scopeId","data-v-12e89caf"]]);export{ct as default};
