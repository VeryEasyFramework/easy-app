var J=Object.defineProperty;var Q=(r,i,e)=>i in r?J(r,i,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[i]=e;var P=(r,i,e)=>Q(r,typeof i!="symbol"?i+"":i,e);import{_ as X}from"./ListDetailLayout.vue_vue_type_style_index_0_lang--9z_-WoG.js";import{a as $,o as p,c as k,w as d,b as a,C as E,h as L,t as b,l as V,L as S,K as z,p as Y,f as F,e as Z,q as w,G as _,s as D,M as N,k as R,g as ee,N as te,u as ie,O as se,P as ne,v as le,_ as ae}from"./RootLayout.vue_vue_type_style_index_0_lang-Daht9VYz.js";import{M as A,_ as M,a as K,e as oe,l as re,T as de}from"./main-BjLzdXxB.js";import{C as W}from"./CardWidget-BWybu92I.js";import{_ as H}from"./DisplayTimestamp.vue_vue_type_script_setup_true_lang-Caw_0bzM.js";import{i as ue,l as ce,_ as fe}from"./index-m24kzHXo.js";import"./InputPassword.vue_vue_type_script_setup_true_lang-C93mQmMy.js";const pe={class:"text-small text-primary bold item-label"},me={class:"text-small italic text-primary-bright"},ye=$({__name:"EntityListItem",props:{entityDef:{},record:{},active:{type:Boolean},fields:{}},emits:["select"],setup(r,{emit:i}){return(e,o)=>(p(),k(W,{class:Y(["full-width entity-list-item position-relative",{active:e.active}]),onClick:o[0]||(o[0]=n=>e.$emit("select",e.record.id))},{default:d(()=>[a(E,{class:"row shrink"},{default:d(()=>[a(E,{class:"col shrink horizontal-align-between"},{default:d(()=>[L("div",pe,b(e.record[e.entityDef.config.titleField||"id"]),1)]),_:1}),a(E,{class:"col shrink"},{default:d(()=>[(p(!0),V(S,null,z(e.fields,n=>(p(),V("div",{key:n},[L("div",me,b(e.record[n]),1)]))),128))]),_:1})]),_:1}),a(E,{class:"gap-2 pe-2 pt-1 dates col shrink position-absolute top right"},{default:d(()=>[a(E,{class:"col shrink text-tiny italic overflow-visible"},{default:d(()=>[a(A,{icon:"add",size:"0.6"}),a(H,{value:e.record.createdAt,format:"compact"},null,8,["value"])]),_:1}),a(E,{class:"col shrink text-tiny italic overflow-visible"},{default:d(()=>[a(A,{icon:"update",size:"0.6"}),a(H,{value:e.record.updatedAt,format:"compact"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["class"]))}}),he=$({__name:"EasyInput",props:{modelValue:{},field:{},error:{},focus:{type:Boolean},placeholder:{},noLabel:{type:Boolean}},emits:["update:modelValue"],setup(r,{emit:i}){const e=r;F(()=>{if("required"in e.field)return e.field.required}),F(()=>{if("readOnly"in e.field)return e.field.readOnly});const o=i,n=F({get:()=>e.modelValue,set:c=>{o("update:modelValue",c)}});return(c,v)=>(p(),k(Z(w(ue)[e.field.fieldType]),{modelValue:n.value,"onUpdate:modelValue":v[0]||(v[0]=u=>n.value=u),field:e.field,required:c.field.required,label:c.field.label,readOnly:c.field.readOnly,error:e.error,name:c.field.key,placeholder:c.placeholder,focus:e.focus,description:c.field.description,noLabel:e.noLabel},null,8,["modelValue","field","required","label","readOnly","error","name","placeholder","focus","description","noLabel"]))}}),ve={class:"title-3"},Le=$({__name:"NewEntityForm",props:{entityDef:{}},emits:["close"],setup(r,{emit:i}){function e(){C("close")}async function o(){if(!c())return;await K.createEntity(v.entityDef.entityId,u.value)&&e()}let n=[];function c(){let s=!0;return m.value={},n.forEach(g=>{u.value[g.key]||(m.value[g.key]="This field is required.",s=!1)}),s}const v=r,u=_({}),m=_({}),C=i;return ce(s=>{s.key==="Escape"&&e(),s.key==="Enter"&&o()}),D(()=>{n=v.entityDef.fields.filter(s=>s.required),n.forEach(s=>{s.defaultValue&&(u.value[s.key]=s.defaultValue)})}),(s,g)=>(p(),k(R,{class:"row-gap-4"},{default:d(()=>[L("div",ve," New "+b(s.entityDef.config.label),1),L("form",{onSubmit:g[0]||(g[0]=N(()=>{},["prevent"]))},[a(E,{class:"col-2 row-gap-4 column-gap-3"},{default:d(()=>[(p(!0),V(S,null,z(s.entityDef.fields.filter(f=>f.required),(f,I)=>(p(),k(he,{focus:I==0,field:f,error:m.value[f.key],modelValue:u.value[f.key],"onUpdate:modelValue":T=>u.value[f.key]=T,key:f.key},null,8,["focus","field","error","modelValue","onUpdate:modelValue"]))),128))]),_:1})],32),a(E,{class:"col shrink horizontal-align-center"},{default:d(()=>[a(M,{onClick:e,icon:"close",color:"error",size:"1"}),a(M,{type:"submit",onClick:N(o,["prevent"]),icon:"check",color:"success",size:"1"})]),_:1})]),_:1}))}});class _e{constructor(){P(this,"initialized");P(this,"entity");P(this,"listInfo");P(this,"entityList");P(this,"isListLoading",!1);P(this,"listOptions");P(this,"easyApi");this.easyApi=K,this.initialized=!1,this.entityList=_([]),this.listOptions={offset:0},this.listInfo={totalCount:_(0),itemsLoaded:_(0),itemsPerPage:0,listHeight:_(0),limitStart:0,resetScroll:_(!1),currentPage:1}}async init(i){var e;((e=this.entity)==null?void 0:e.entityId)==i.entityId&&(this.entityList.value=[],this.listOptions.columns=i.listFields,this.listOptions.orderBy=i.config.orderField||"updatedAt",this.listOptions.order=i.config.orderDirection||"desc",this.entity=i,this.initialized||(this.initialized=!0))}reset(){this.entityList.value=[],this.listInfo.totalCount.value=0,this.listInfo.itemsLoaded.value=0,this.listInfo.currentPage=1,this.listInfo.limitStart=0}async loadList(){if(!this.isListLoading){this.isListLoading=!0;const{data:i,columns:e,rowCount:o,totalCount:n}=await this.easyApi.getList(this.entity.entityId,{...this.listOptions,offset:this.listInfo.limitStart,limit:this.listInfo.itemsPerPage});this.entityList.value.push(...i),this.listInfo.totalCount.value=n,this.listInfo.itemsLoaded.value=o,this.isListLoading=!1,this.listInfo.resetScroll.value=!0}}async loadMore(i){if(!(this.listInfo.itemsLoaded.value>=this.listInfo.totalCount.value)&&!this.isListLoading){this.isListLoading=!0;const e=this.entityList.value.length,o=i-e+this.listInfo.itemsPerPage,{data:n,columns:c,rowCount:v,totalCount:u}=await this.easyApi.getList(this.entity.entityId,{...this.listOptions,offset:e,limit:o});this.entityList.value.push(...n),this.listInfo.totalCount.value=u,this.listInfo.itemsLoaded.value=this.entityList.value.length,this.listInfo.currentPage=Math.floor(this.entityList.value.length/this.listInfo.itemsPerPage),this.isListLoading=!1}}}const ge=$({__name:"TransitionList",props:{fade:{type:Boolean}},setup(r){return(i,e)=>(p(),k(te,{name:i.fade?"list-fade":"list"},{default:d(()=>[ee(i.$slots,"default")]),_:3},8,["name"]))}}),Ie={class:"position-relative input"},we=$({__name:"EntitySearchInput",props:{entity:{}},emits:["search"],setup(r,{emit:i}){const e=r;let o=[];const n=["DataField","EmailField","TextField","IntField","PhoneField"];D(()=>{if(!e.entity)throw new Error("EntitySearchInput requires an entity prop");o=e.entity.fields.filter(u=>n.includes(u.fieldType))});const c=i;function v(u){const m=u.target.value,C={};o.forEach(s=>{const g=s.fieldType;let f="contains";if(g==="IntField"){const I=parseInt(m);if(isNaN(I))return;f="=",C[s.key]={op:f,value:I};return}C[s.key]={op:f,value:m}}),c("search",C)}return(u,m)=>(p(),V("div",Ie,[L("input",{type:"search",placeholder:"Type to search...",onInput:v},null,32)]))}}),Ee={class:"title-3"},ke={class:"label text-end"},Ce={class:"grid standard-grid-no-padding list-wrapper"},U=3,G=60,Pe=$({__name:"EntityList",props:{entity:{},activeEntity:{}},emits:["select"],setup(r,{emit:i}){ie(t=>({"5c50f606":T,"13a6fa7f":g,"1439cd60":f.value}));const e=new _e,o=r;let n=_();function c(){m.value=!0}function v(){m.value=!1}function u(t){e.listOptions.orFilter=t,e.loadList()}const m=_(!1);let C=[];se(async()=>{const t=oe.entities.find(l=>l.entityId===o.entity);t&&(n.value=t,e.entity=t,C=t.listFields.filter(l=>!["id","createdAt","updatedAt",t.config.titleField].includes(l)))}),re(o.entity,"list",async t=>{e.entityList.value.forEach((l,y)=>{l.id===t.id&&(e.entityList.value[y]=t)})});const s=ne("infinite"),g=`${U}px`,f=_("0"),I=G+U,T=`${G}px`;D(async()=>{var l;await e.init(n.value);const t=(l=s.value)==null?void 0:l.parentElement;t&&await q(t),window.addEventListener("resize",B),t==null||t.addEventListener("scroll",O)}),le(()=>{var l;const t=(l=s.value)==null?void 0:l.parentElement;t==null||t.removeEventListener("scroll",O),window.removeEventListener("resize",B)});async function O(t){const y=t.currentTarget.scrollTop,h=Math.floor(y/I+e.listInfo.itemsPerPage);h+3>e.listInfo.itemsLoaded.value&&(await e.loadMore(h),setTimeout(j,500))}async function j(){var y,h;const t=(h=(y=s.value)==null?void 0:y.parentElement)==null?void 0:h.scrollTop;let l=Math.floor(t/I+e.listInfo.itemsPerPage);l>e.listInfo.totalCount.value&&(l=e.listInfo.totalCount.value),l>e.listInfo.itemsLoaded.value&&await e.loadMore(l)}async function B(){var t;await q((t=s.value)==null?void 0:t.parentElement)}async function q(t){const l=t.getBoundingClientRect(),y=Math.floor(l.height/I);e.listInfo.itemsPerPage=y*2,t.scrollTop=0,e.reset(),await e.loadList(),f.value=`${e.listInfo.totalCount.value*I}px`}return(t,l)=>(p(),k(R,{class:"entity-list-wrapper"},{default:d(()=>{var y;return[L("div",Ee,b((y=w(n))==null?void 0:y.config.label),1),a(W,null,{default:d(()=>[a(E,{class:"list-header col horizontal-align-between"},{default:d(()=>[a(we,{entity:w(n),onSearch:u},null,8,["entity"]),L("div",null,[a(M,{label:`New ${t.entity}`,onClick:c,icon:"add",size:"1"},null,8,["label"])])]),_:1})]),_:1}),L("div",ke," Loaded "+b(w(e).listInfo.itemsLoaded)+" of "+b(w(e).listInfo.totalCount)+" records ",1),L("div",Ce,[L("div",{ref_key:"infinite",ref:s,class:"grid standard-grid-no-padding list-container row infinite overflow-hidden"},[a(ge,{fade:""},{default:d(()=>[(p(!0),V(S,null,z(w(e).entityList.value,h=>(p(),k(ye,{active:t.activeEntity==h.id,key:h.id,entityDef:w(n),fields:w(C),record:h,onSelect:l[0]||(l[0]=x=>t.$emit("select",x))},null,8,["active","entityDef","fields","record"]))),128))]),_:1})],512)]),a(fe,{modelValue:m.value,"onUpdate:modelValue":l[1]||(l[1]=h=>m.value=h)},{default:d(()=>[a(Le,{entityDef:w(e).entity,onClose:v},null,8,["entityDef"])]),_:1},8,["modelValue"])]}),_:1}))}}),$e=$({__name:"EntityListView",props:{entity:{},id:{}},setup(r){const i=r;return(e,o)=>(p(),k(X,{maxWidth:"400px"},{list:d(()=>[a(Pe,{entity:e.entity,activeEntity:e.id,onSelect:o[0]||(o[0]=n=>e.$router.push(`/entity/${e.entity}/${n}`))},null,8,["entity","activeEntity"])]),detail:d(()=>[(p(),k(de,{key:i.id}))]),_:1}))}}),Oe=ae($e,[["__scopeId","data-v-aec2ef88"]]);export{Oe as default};
