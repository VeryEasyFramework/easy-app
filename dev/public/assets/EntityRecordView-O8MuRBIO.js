import{C as O}from"./CardWidget-CLnvhoga.js";import{d as F,o as d,c as m,w as n,b as t,e as h,C as v,f as R,a as b,q as x,p as V,z as w,F as E,s as T,t as C,l as g,g as K,v as P,B,x as S,E as G,h as L,L as q,j as W,i as U,A as H,n as J}from"./index-BYjH4yJH.js";import{_ as Q}from"./LoaderOverlay.vue_vue_type_style_index_0_lang-DRyefla4.js";import{_ as M,a as A,M as I}from"./ButtonIcon.vue_vue_type_script_setup_true_lang-Cbo9dm9r.js";import{R as X,_ as Y,a as N}from"./RecordAttendance-lN3_p2SH.js";import{a as j,l as Z,o as ee,_ as te,g as le,f as ae}from"./EasyInput.vue_vue_type_script_setup_true_lang-BTbdhf5x.js";import{_ as oe}from"./DisplayChoices.vue_vue_type_style_index_0_lang-di4owrzL.js";import"./FormBase.vue_vue_type_script_setup_true_lang-CON9pmVo.js";import"./TransitionList.vue_vue_type_style_index_0_lang-BLagXTsR.js";import"./Button.vue_vue_type_script_setup_true_lang-D7t9y8YO.js";import"./InputData.vue_vue_type_script_setup_true_lang-D0e4q8ZS.js";const ne=F({__name:"EntityInfo",props:{entityDef:{},record:{}},setup($){return(r,e)=>(d(),m(v,null,{default:n(()=>[t(v,{class:"col"},{default:n(()=>[e[0]||(e[0]=h("div",{class:"label"},"Created At:",-1)),t(j,{class:"label text-info-dark",value:r.record.createdAt},null,8,["value"])]),_:1}),t(v,{class:"col"},{default:n(()=>[e[1]||(e[1]=h("div",{class:"label"},"Last Updated:",-1)),t(j,{class:"label text-info-dark",value:r.record.updatedAt},null,8,["value"])]),_:1})]),_:1}))}}),ie=F({__name:"EntityToolbar",props:{editMode:{type:Boolean}},emits:["edit","save","delete"],setup($,{emit:r}){const e=r,l=$;return Z(a=>{ee(a,()=>{l.editMode&&e("save")})}),(a,i)=>(d(),m(v,{class:"toolbar col shrink"},{default:n(()=>[t(A,{speed:"fast"},{default:n(()=>[a.editMode?(d(),m(M,{key:0,icon:"save",size:"1",color:"success",onClick:i[0]||(i[0]=p=>a.$emit("save"))})):R("",!0)]),_:1}),t(A,{speed:"fast"},{default:n(()=>[a.editMode?(d(),m(M,{key:0,onClick:i[1]||(i[1]=p=>a.$emit("delete")),icon:"delete",size:"1",color:"error"})):R("",!0)]),_:1}),t(M,{onClick:i[2]||(i[2]=p=>a.$emit("edit",!a.editMode)),icon:a.editMode?"edit_off":"edit",label:"Edit Mode",color:"warning",size:"1"},null,8,["icon"])]),_:1}))}}),se={class:"time italic"},de=F({__name:"EntityEditLog",props:{editLog:{}},setup($){const r={create:"created",update:"updated",delete:"deleted"},e=b(),l=b(!1);return(a,i)=>{const p=x("RouterLink");return d(),m(v,{class:"edit-log row shrink gap-3 position-relative"},{default:n(()=>[i[1]||(i[1]=h("div",{class:"title-5"},"Edit Log",-1)),t(T,{class:"edit-log-container row shrink gap-3"},{default:n(()=>[(d(!0),V(E,null,w(a.editLog,u=>(d(),m(v,{class:"edit-log-entry col shrink text-small",key:u.id},{default:n(()=>[h("div",se,C(g(le)(u.createdAt,{format:"pretty"})),1),t(p,{class:"user-link",to:`/entity/user/${u.user}`},{default:n(()=>[K(C(u.userFullName),1)]),_:2},1032,["to"]),h("div",{class:P(u.action)},C(r[u.action]),3),h("div",null,C(u.recordTitle||u.recordId),1),t(I,{class:"cursor-pointer",icon:"info",onClick:k=>{e.value=u,l.value=!0}},null,8,["onClick"])]),_:2},1024))),128))]),_:1}),e.value&&l.value?(d(),m(v,{key:0,class:"position-absolute w-100 h-100 top left row shrink"},{default:n(()=>{var u;return[t(I,{class:"cursor-pointer horizontal-align-self-end",icon:"close",onClick:i[0]||(i[0]=k=>l.value=!1)}),t(te,{value:(u=e.value)==null?void 0:u.editData},null,8,["value"])]}),_:1})):R("",!0)]),_:1})}}}),re=F({__name:"ChildInput",props:{modelValue:{},titleValue:{},field:{},editable:{type:Boolean},error:{},focus:{type:Boolean},placeholder:{}},emits:["selected","update:modelValue","update:titleValue"],setup($,{emit:r}){const e=$,l=r,a=B({get:()=>e.modelValue,set:p=>{l("update:modelValue",p)}}),i=B({get:()=>e.titleValue,set:p=>{l("update:titleValue",p)}});return S(()=>{console.log(e.modelValue),console.log(e.field.key)}),(p,u)=>(d(),m(G(g(ae)[e.field.fieldType]),{modelValue:a.value,"onUpdate:modelValue":u[0]||(u[0]=k=>a.value=k),field:e.field,error:e.error,editable:e.editable,placeholder:p.placeholder,focus:e.focus,noLabel:!0,onSelected:u[1]||(u[1]=k=>p.$emit("selected",k)),titleValue:i.value,"onUpdate:titleValue":u[2]||(u[2]=k=>i.value=k)},null,40,["modelValue","field","error","editable","placeholder","focus","titleValue"]))}}),ue={class:"title-5 text-primary"},ce=F({__name:"ChildList",props:{child:{},modelValue:{}},emits:["update:modelValue"],setup($,{emit:r}){const e=$,l=r,a=b([]);S(()=>{a.value=e.modelValue});const i=B(()=>{const _=e.child.fields.filter(f=>f.connectionTitleField).map(f=>f.connectionTitleField);return e.child.fields.filter(f=>!(_.includes(f.key)||f.hidden))});function p(){const _=a.value.map((f,c)=>(f.order=c,f));a.value=_}async function u(_,f,c){const y=e.child.fields.filter(o=>{var D;return((D=o.fetchOnCreate)==null?void 0:D.idKey)===f.key});if(y.length===0)return;const s=await L.getEntity(f.connectionEntity,_);y.forEach(o=>{c[o.key]=s[o.fetchOnCreate.field]})}function k(_){a.value=a.value.filter((f,c)=>c!==_),p(),l("update:modelValue",a.value)}function z(){const _=e.child.fields,f={id:"",order:a.value.length};_.forEach(c=>{f[c.key]=c.defaultValue}),a.value.push(f),p(),l("update:modelValue",a.value)}return(_,f)=>(d(),m(v,{class:"row shrink child-list"},{default:n(()=>[t(v,{class:"col shrink vertical-align-center"},{default:n(()=>[h("div",ue,C(_.child.label),1),t(M,{class:"add-button",icon:"add",size:"0.8",onClick:z})]),_:1}),t(T,{class:"row shrink card dark"},{default:n(()=>[t(v,{class:"col"},{default:n(()=>[(d(!0),V(E,null,w(i.value,c=>(d(),V("div",{class:"label",key:c.key},C(c.label),1))),128))]),_:1}),(d(!0),V(E,null,w(a.value,(c,y)=>(d(),m(v,{class:"col child-record card",key:c.id},{default:n(()=>[(d(!0),V(E,null,w(i.value,s=>(d(),V("div",{key:`${c.id}${s.key}`},[(d(),m(re,{field:s,onSelected:o=>u(o,s,c),modelValue:c[s.key],"onUpdate:modelValue":o=>c[s.key]=o,titleValue:c[s.connectionTitleField?s.connectionTitleField:""],"onUpdate:titleValue":o=>c[s.connectionTitleField?s.connectionTitleField:""]=o,key:s.key},null,8,["field","onSelected","modelValue","onUpdate:modelValue","titleValue","onUpdate:titleValue"]))]))),128)),h("div",null,C(c.order),1),t(M,{icon:"delete",onClick:s=>k(y),size:"0.8"},null,8,["onClick"])]),_:2},1024))),128))]),_:1})]),_:1}))}}),fe={class:"title-4"},pe={class:"text-small italic text-primary-bright"},ve={key:0,class:"choice"},me={class:"fit-content"},Fe=F({__name:"EntityRecordView",props:{entity:{},id:{}},setup($){const r=$;let e={};const l=b({}),a=b({editLog:[]}),i={loaded:b(!1),saving:b(!1)},p=b(!1);async function u(){i.loaded.value=!1,l.value=await L.getEntity(r.entity,r.id),i.loaded.value=!0}async function k(){a.value=await L.getRecordInfo(r.entity,r.id)}async function z(){if(!l.value)return;i.saving.value=!0;const y=l.value;await L.updateEntity(r.entity,y.id,y),i.saving.value=!1}async function _(){l.value&&(i.saving.value=!0,await L.deleteEntity(r.entity,l.value.id),i.saving.value=!1,await U.push(`/entity/${r.entity}`))}function f(y,s){s.user;const o=s.users;c.value=o}const c=b([]);return q(r.entity,r.id,(y,s)=>{switch(console.log("event",y,s),y){case"update":console.log(s),console.log(Object.keys(s)),l.value=s,J({message:`${e.config.label} ${l.value[e.config.titleField||"id"]} was updated`,title:`${e.config.label} Updated`,type:"success"});break;case"delete":U.push(`/entity/${r.entity}`);break;case"join":f("join",s);break;case"leave":f("leave",s)}}),W(()=>{if(!r.id||!r.entity)return U.push("/entity");const y=H.getDef(r.entity);if(!y)return U.push("/entity");e=y}),S(async()=>{await u(),await k()}),(y,s)=>(d(),m(A,null,{default:n(()=>[i.loaded.value?(d(),m(T,{key:0,class:"position-relative entity-record-grid"},{default:n(()=>[t(v,{class:"top-bar col shrink vertical-align-center horizontal-align-between"},{default:n(()=>[t(v,null,{default:n(()=>[h("div",fe,C(l.value[g(e).config.titleField||"id"]),1),h("div",pe,C(l.value.id),1),g(e).statusField?(d(),V("div",ve,[t(oe,{value:l.value[g(e).statusField.key],field:g(e).statusField},null,8,["value","field"])])):R("",!0)]),_:1}),t(v,{class:"col shrink"},{default:n(()=>[h("div",me,[t(X,{users:c.value},null,8,["users"])]),t(ie,{editMode:p.value,onSave:z,onDelete:_,onEdit:s[0]||(s[0]=o=>p.value=o)},null,8,["editMode"])]),_:1})]),_:1}),t(T,{class:"fields"},{default:n(()=>[t(v,{class:"row shrink"},{default:n(()=>[(d(!0),V(E,null,w(g(e).fieldGroups.filter(o=>o.key!=="default"),o=>(d(),m(N,{edit:p.value,group:o,record:l.value,key:o.key},null,8,["edit","group","record"]))),128)),(d(!0),V(E,null,w(g(e).fieldGroups.filter(o=>o.key==="default"),o=>(d(),m(N,{edit:p.value,group:o,record:l.value,key:o.key},null,8,["edit","group","record"]))),128))]),_:1})]),_:1}),t(v,{class:"info"},{default:n(()=>[t(ne,{entityDef:g(e),record:l.value},null,8,["entityDef","record"])]),_:1}),t(v,{class:"actions"},{default:n(()=>[t(Y,{entityDef:g(e),record:l.value,type:"entity"},null,8,["entityDef","record"])]),_:1}),t(v,{class:"children"},{default:n(()=>[(d(!0),V(E,null,w(g(e).children,o=>(d(),m(ce,{child:o,modelValue:l.value[o.childName],"onUpdate:modelValue":D=>l.value[o.childName]=D},null,8,["child","modelValue","onUpdate:modelValue"]))),256))]),_:1}),t(v,{class:"editLog vertical-align-end"},{default:n(()=>[t(O,{class:"h-100"},{default:n(()=>[t(de,{"edit-log":a.value.editLog},null,8,["edit-log"])]),_:1})]),_:1}),t(Q,{loaded:!i.saving.value},null,8,["loaded"])]),_:1})):R("",!0)]),_:1}))}});export{Fe as default};
