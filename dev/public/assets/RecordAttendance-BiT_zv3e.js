import{d as C,a as c,x as F,o as u,c as m,w as t,e as f,b as s,p as y,z as A,F as w,C as p,s as N,t as k,h as D,n as S,B as U,v as R,m as E,l as W,_ as z}from"./index-BLUmWJ0B.js";import{_ as P,M as H}from"./ButtonIcon.vue_vue_type_script_setup_true_lang-Clz7Z40D.js";import{C as B}from"./CardWidget-DGg9H3FA.js";import{b as L,c as T}from"./index-DBKjfLVL.js";import{_ as q}from"./FormBase.vue_vue_type_script_setup_true_lang-D-zhasFN.js";import{_ as M,a as G}from"./TransitionList.vue_vue_type_style_index_0_lang-B0UJVPA5.js";const K={class:"title-5 text-accent"},O={class:"text-small italic"},X={class:"title-4 text-center"},oe=C({__name:"EntityActions",props:{entityDef:{},type:{},record:{}},setup(_){const d=_,v=c([]),a=c({key:"",label:"",description:"",params:[],action:()=>{}}),i=c({}),r=c(!1);F(()=>{v.value=d.entityDef.actions.filter(o=>!o.private)});async function h(o){if(a.value=o,o.params&&o.params.length>0){i.value={},o.params.forEach(l=>{i.value[l.key]={error:"",value:null}}),r.value=!0;return}await b(o)}async function b(o){if(!V(o,i.value))return;const l={};for(const n in i.value)l[n]=i.value[n].value;let e={};switch(d.type){case"entity":e=await D.runEntityAction(d.entityDef.entityId,d.record.id,o.key,l);break;case"settings":e=await D.call("settings","runSettingsAction",{settings:d.entityDef.settingsId,action:o.key,data:l});break}S({title:`Action ${o.label||o.key} completed`,message:e.message||e||"Action completed",type:"success"}),i.value={},a.value={key:"",label:"",description:"",params:[],action:()=>{}},r.value=!1}function V(o,l){let e=!1;if(!o.params)return!0;for(const n of o.params){if(n.required&&!l[n.key].value){l[n.key].error="Please provide a value",e=!0;continue}l[n.key].error=""}return!e}return(o,l)=>(u(),m(N,{class:"row shrink"},{default:t(()=>[l[3]||(l[3]=f("div",null,[f("div",{class:"title-4"},"Actions")],-1)),s(p,{class:"row shrink"},{default:t(()=>[(u(!0),y(w,null,A(v.value,e=>(u(),m(B,{key:e.key},{default:t(()=>[s(p,{class:"col-2 shrink vertical-align-center"},{default:t(()=>[s(P,{icon:"play_arrow",color:"secondary",onClick:n=>h(e),label:e.label,key:"play"},null,8,["onClick","label"]),s(p,null,{default:t(()=>[f("div",K,k(e.label),1),f("div",O,k(e.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),s(L,{modelValue:r.value,"onUpdate:modelValue":l[2]||(l[2]=e=>r.value=e)},{default:t(()=>[s(N,{class:"row row-gap-4"},{default:t(()=>[f("div",X,k(a.value.label||a.value.key),1),s(q,{name:"actionParamsForm",onSubmitted:l[1]||(l[1]=async()=>await b(a.value))},{default:t(()=>[s(p,{class:"row row-gap-4"},{default:t(()=>[s(p,null,{default:t(()=>[(u(!0),y(w,null,A(a.value.params,e=>(u(),y("div",{key:e.key},[s(M,{field:e,editable:"",modelValue:i.value[e.key].value,"onUpdate:modelValue":n=>i.value[e.key].value=n,error:i.value[e.key].error},null,8,["field","modelValue","onUpdate:modelValue","error"])]))),128))]),_:1}),s(p,{class:"col shrink horizontal-align-center gap-3"},{default:t(()=>[s(P,{icon:"cancel",color:"error",onClick:l[0]||(l[0]=e=>r.value=!1),label:"Cancel"}),s(P,{icon:"play_arrow",type:"submit",color:"secondary",label:a.value.label},null,8,["label"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),Y={class:"title-4 text-primary"},ne=C({__name:"EntityFieldGroup",props:{group:{},edit:{type:Boolean},record:{}},setup(_){const d=_,v=U(()=>d.group.fields.filter(a=>{var i;return!(a.hidden||(i=a.fetchOptions)!=null&&i.thisIdKey)}));return(a,i)=>(u(),m(B,{class:""},{default:t(()=>[s(p,{class:"row shrink"},{default:t(()=>[f("div",Y,k(a.group.title),1),s(p,{class:R(["group-fields col shrink column-gap-3 overflow-hidden",{edit:a.edit}])},{default:t(()=>[s(p,{class:"col-2 field-values"},{default:t(()=>[(u(!0),y(w,null,A(v.value,r=>(u(),m(p,{key:`${r.key}value`},{default:t(()=>[s(M,{editable:a.edit,field:r,modelValue:a.record[r.key],"onUpdate:modelValue":h=>a.record[r.key]=h},null,8,["editable","field","modelValue","onUpdate:modelValue"])]),_:2},1024))),128))]),_:1})]),_:1},8,["class"])]),_:1})]),_:1}))}}),j={class:"label"},J=C({__name:"Popover",props:{text:{},wait:{},position:{}},setup(_){const d=_,v=c("0px"),a=c("0px");c(null);const i=c();F(()=>{});const r=c(!1);function h(){var e;(e=i.value)==null||e.showPopover()}function b(){var e;(e=i.value)==null||e.hidePopover()}function V(e){var n,g;r.value=!0,l((g=(n=e.target)==null?void 0:n.firstElementChild)==null?void 0:g.getBoundingClientRect(),i.value),setTimeout(()=>{r.value&&h()},d.wait??300)}function o(){r.value=!1,setTimeout(()=>{b()},d.wait??300)}function l(e,n){if(!e)return;const g=n.offsetHeight,I=n.offsetWidth;let $,x;window.innerHeight-(e==null?void 0:e.top)<g?x=(e==null?void 0:e.top)-g:x=e==null?void 0:e.top,window.innerWidth-(e==null?void 0:e.left)<I?$=(e==null?void 0:e.left)+I+5:$=(e==null?void 0:e.left)+(e==null?void 0:e.width)+5,n.style.top=`${x}px`,n.style.left=`${$}px`,v.value=`${x}px`,a.value=`${$}px`}return(e,n)=>(u(),y(w,null,[f("div",{style:{display:"contents"},onMouseenter:V,onMouseleave:o},[E(e.$slots,"default")],32),f("div",{ref_key:"popover",ref:i,class:"popover",popover:""},[E(e.$slots,"popover",{},()=>[s(B,{class:"shadow"},{default:t(()=>[f("div",j,k(e.text),1)]),_:1})])],512)],64))}}),Q=C({__name:"RecordAttendance",props:{users:{}},setup(_){return(d,v)=>(u(),m(p,{class:"col shrink overflow-visible"},{default:t(()=>[s(G,null,{default:t(()=>[(u(!0),y(w,null,A(d.users,a=>(u(),m(J,{text:`${a.firstName} ${a.lastName}`,key:a.id},{default:t(()=>[(u(),m(p,{class:"col cursor-pointer label overflow-visible avatar shrink vertical-align-center bg-primary border px-2",key:a.id},{default:t(()=>[s(H,{icon:"person",class:"avatar"}),f("div",null,k(W(T)(`${a.firstName} ${a.lastName}`,"initials")),1)]),_:2},1024))]),_:2},1032,["text"]))),128))]),_:1})]),_:1}))}}),ie=z(Q,[["__scopeId","data-v-02ca1f19"]]);export{ie as R,oe as _,ne as a};
