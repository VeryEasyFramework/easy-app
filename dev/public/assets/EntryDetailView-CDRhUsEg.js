import{d as E,B as A,x as I,o as i,c as v,E as x,l as g,a as b,w as s,b as t,C as y,e as h,t as C,s as z,p as V,F as T,z as w,h as F,q as K,f as M,g as O,v as P,L as G,j as q,i as U,A as W,n as H}from"./index-CS0ctzBO.js";import{_ as J}from"./DisplayChoices.vue_vue_type_style_index_0_lang-zD-gM-pX.js";import{R as Q,_ as X,a as N}from"./EntryFieldGroup.vue_vue_type_style_index_0_lang-BwTWXxhL.js";import{_ as L,M as D,a as S}from"./ButtonIcon.vue_vue_type_script_setup_true_lang-CJazxrdG.js";import{f as Y,_ as Z,g as ee,l as te,o as le,a as j}from"./EasyInput.vue_vue_type_script_setup_true_lang-DyZPaHgo.js";import{C as ae}from"./CardWidget-CZble4Vm.js";import{_ as ne}from"./LoaderOverlay.vue_vue_type_style_index_0_lang-CscSw_zg.js";import"./FormBase.vue_vue_type_script_setup_true_lang-D9V7oIsE.js";import"./TransitionList.vue_vue_type_style_index_0_lang-DHrpeRMs.js";import"./Button.vue_vue_type_script_setup_true_lang-BTGI5PMB.js";import"./InputData.vue_vue_type_script_setup_true_lang-D720uB00.js";const se=E({__name:"ChildInput",props:{modelValue:{},titleValue:{},field:{},editable:{type:Boolean},error:{},focus:{type:Boolean},placeholder:{}},emits:["selected","update:modelValue","update:titleValue"],setup($,{emit:r}){const e=$,l=r,a=A({get:()=>e.modelValue,set:f=>{l("update:modelValue",f)}}),o=A({get:()=>e.titleValue,set:f=>{l("update:titleValue",f)}});return I(()=>{}),(f,d)=>(i(),v(x(g(Y)[e.field.fieldType]),{modelValue:a.value,"onUpdate:modelValue":d[0]||(d[0]=_=>a.value=_),field:e.field,error:e.error,editable:e.editable,placeholder:f.placeholder,focus:e.focus,noLabel:!0,onSelected:d[1]||(d[1]=_=>f.$emit("selected",_)),titleValue:o.value,"onUpdate:titleValue":d[2]||(d[2]=_=>o.value=_)},null,40,["modelValue","field","error","editable","placeholder","focus","titleValue"]))}}),oe={class:"title-5 text-primary"},ie=E({__name:"ChildList",props:{child:{},modelValue:{}},emits:["update:modelValue"],setup($,{emit:r}){const e=$,l=r,a=b([]);I(()=>{a.value=e.modelValue});const o=A(()=>{const m=e.child.fields.filter(p=>p.connectionTitleField).map(p=>p.connectionTitleField);return e.child.fields.filter(p=>!(m.includes(p.key)||p.hidden))});function f(){const m=a.value.map((p,u)=>(p.order=u,p));a.value=m}async function d(m,p,u){const k=e.child.fields.filter(n=>{var R;return((R=n.fetchOnCreate)==null?void 0:R.idKey)===p.key});if(k.length===0)return;const c=await F.getEntry(p.connectionEntryType,m);k.forEach(n=>{u[n.key]=c[n.fetchOnCreate.field]})}function _(m){a.value=a.value.filter((p,u)=>u!==m),f(),l("update:modelValue",a.value)}function B(){const m=e.child.fields,p={id:"",order:a.value.length};m.forEach(u=>{p[u.key]=u.defaultValue}),a.value.push(p),f(),l("update:modelValue",a.value)}return(m,p)=>(i(),v(y,{class:"row shrink child-list"},{default:s(()=>[t(y,{class:"col shrink vertical-align-center"},{default:s(()=>[h("div",oe,C(m.child.label),1),t(L,{class:"add-button",icon:"add",size:"0.8",onClick:B})]),_:1}),t(z,{class:"row shrink card dark"},{default:s(()=>[t(y,{class:"col"},{default:s(()=>[(i(!0),V(T,null,w(o.value,u=>(i(),V("div",{class:"label",key:u.key},C(u.label),1))),128))]),_:1}),(i(!0),V(T,null,w(a.value,(u,k)=>(i(),v(y,{class:"col child-record card",key:u.id},{default:s(()=>[(i(!0),V(T,null,w(o.value,c=>(i(),V("div",{key:`${u.id}${c.key}`},[(i(),v(se,{field:c,onSelected:n=>d(n,c,u),modelValue:u[c.key],"onUpdate:modelValue":n=>u[c.key]=n,titleValue:u[c.connectionTitleField?c.connectionTitleField:""],"onUpdate:titleValue":n=>u[c.connectionTitleField?c.connectionTitleField:""]=n,key:c.key},null,8,["field","onSelected","modelValue","onUpdate:modelValue","titleValue","onUpdate:titleValue"]))]))),128)),h("div",null,C(u.order),1),t(L,{icon:"delete",onClick:c=>_(k),size:"0.8"},null,8,["onClick"])]),_:2},1024))),128))]),_:1})]),_:1}))}}),re={class:"time italic"},de=E({__name:"EntryEditLog",props:{editLog:{}},setup($){const r={create:"created",update:"updated",delete:"deleted"},e=b(),l=b(!1);return(a,o)=>{const f=K("RouterLink");return i(),v(y,{class:"edit-log row shrink gap-3 position-relative"},{default:s(()=>[o[1]||(o[1]=h("div",{class:"title-5"},"Edit Log",-1)),t(z,{class:"edit-log-container row shrink gap-3"},{default:s(()=>[(i(!0),V(T,null,w(a.editLog,d=>(i(),v(y,{class:"edit-log-entry col shrink text-small",key:d.id},{default:s(()=>[h("div",re,C(g(ee)(d.createdAt,{format:"pretty"})),1),t(f,{class:"user-link",to:`/entry/user/${d.user}`},{default:s(()=>[O(C(d.userFullName),1)]),_:2},1032,["to"]),h("div",{class:P(d.action)},C(r[d.action]),3),h("div",null,C(d.entryTitle||d.entryId),1),t(D,{class:"cursor-pointer",icon:"info",onClick:_=>{e.value=d,l.value=!0}},null,8,["onClick"])]),_:2},1024))),128))]),_:1}),e.value&&l.value?(i(),v(y,{key:0,class:"position-absolute w-100 h-100 top left row shrink"},{default:s(()=>{var d;return[t(D,{class:"cursor-pointer horizontal-align-self-end",icon:"close",onClick:o[0]||(o[0]=_=>l.value=!1)}),t(Z,{value:(d=e.value)==null?void 0:d.editData},null,8,["value"])]}),_:1})):M("",!0)]),_:1})}}}),ue=E({__name:"EntryToolbar",props:{editMode:{type:Boolean}},emits:["edit","save","delete"],setup($,{emit:r}){const e=r,l=$;return te(a=>{le(a,()=>{l.editMode&&e("save")})}),(a,o)=>(i(),v(y,{class:"toolbar col shrink"},{default:s(()=>[t(S,{speed:"fast"},{default:s(()=>[a.editMode?(i(),v(L,{key:0,icon:"save",size:"1",color:"success",onClick:o[0]||(o[0]=f=>a.$emit("save"))})):M("",!0)]),_:1}),t(S,{speed:"fast"},{default:s(()=>[a.editMode?(i(),v(L,{key:0,onClick:o[1]||(o[1]=f=>a.$emit("delete")),icon:"delete",size:"1",color:"error"})):M("",!0)]),_:1}),t(L,{onClick:o[2]||(o[2]=f=>a.$emit("edit",!a.editMode)),icon:a.editMode?"edit_off":"edit",label:"Edit Mode",color:"warning",size:"1"},null,8,["icon"])]),_:1}))}}),ce=E({__name:"EntryInfo",props:{entryType:{},entry:{}},setup($){return(r,e)=>(i(),v(y,null,{default:s(()=>[t(y,{class:"col"},{default:s(()=>[e[0]||(e[0]=h("div",{class:"label"},"Created At:",-1)),t(j,{class:"label text-info-dark",value:r.entry.createdAt},null,8,["value"])]),_:1}),t(y,{class:"col"},{default:s(()=>[e[1]||(e[1]=h("div",{class:"label"},"Last Updated:",-1)),t(j,{class:"label text-info-dark",value:r.entry.updatedAt},null,8,["value"])]),_:1})]),_:1}))}}),pe={class:"title-4"},fe={class:"text-small italic text-primary-bright"},ye={key:0,class:"choice"},ve={class:"fit-content"},Ee=E({__name:"EntryDetailView",props:{entryType:{},id:{}},setup($){const r=$;let e={};const l=b({}),a=b({editLog:[]}),o={loaded:b(!1),saving:b(!1)},f=b(!1);async function d(){o.loaded.value=!1,l.value=await F.getEntry(r.entryType,r.id),o.loaded.value=!0}async function _(){a.value=await F.getEntryInfo(r.entryType,r.id)}async function B(){l.value&&(o.saving.value=!0,await F.updateEntry(r.entryType,l.value.id,l.value),o.saving.value=!1)}async function m(){l.value&&(o.saving.value=!0,await F.deleteEntry(r.entryType,l.value.id),o.saving.value=!1,await U.push(`/entry/${r.entryType}`))}function p(k,c){c.user;const n=c.users;u.value=n}const u=b([]);return G(r.entryType,r.id,(k,c)=>{switch(k){case"update":l.value=c,H({message:`${e.config.label} ${l.value[e.config.titleField||"id"]} was updated`,title:`${e.config.label} Updated`,type:"success"});break;case"delete":U.push(`/entry/${r.entryType}`);break;case"join":p("join",c);break;case"leave":p("leave",c)}}),q(()=>{if(!r.id||!r.entryType)return U.push("/entry");const k=W.get(r.entryType);if(!k)return U.push("/entry");e=k}),I(async()=>{await d(),await _()}),(k,c)=>(i(),v(S,null,{default:s(()=>[o.loaded.value?(i(),v(z,{key:0,class:"position-relative entry-grid"},{default:s(()=>[t(y,{class:"top-bar col shrink vertical-align-center horizontal-align-between"},{default:s(()=>[t(y,null,{default:s(()=>[h("div",pe,C(l.value[g(e).config.titleField||"id"]),1),h("div",fe,C(l.value.id),1),g(e).statusField?(i(),V("div",ye,[t(J,{value:l.value[g(e).statusField.key],field:g(e).statusField},null,8,["value","field"])])):M("",!0)]),_:1}),t(y,{class:"col shrink"},{default:s(()=>[h("div",ve,[t(Q,{users:u.value},null,8,["users"])]),t(ue,{editMode:f.value,onSave:B,onDelete:m,onEdit:c[0]||(c[0]=n=>f.value=n)},null,8,["editMode"])]),_:1})]),_:1}),t(z,{class:"fields"},{default:s(()=>[t(y,{class:"row shrink"},{default:s(()=>[(i(!0),V(T,null,w(g(e).fieldGroups.filter(n=>n.key!=="default"),n=>(i(),v(N,{edit:f.value,group:n,entry:l.value,key:n.key},null,8,["edit","group","entry"]))),128)),(i(!0),V(T,null,w(g(e).fieldGroups.filter(n=>n.key==="default"),n=>(i(),v(N,{edit:f.value,group:n,entry:l.value,key:n.key},null,8,["edit","group","entry"]))),128))]),_:1})]),_:1}),t(y,{class:"info"},{default:s(()=>[t(ce,{"entry-type":g(e),entry:l.value},null,8,["entry-type","entry"])]),_:1}),t(y,{class:"actions"},{default:s(()=>[t(X,{"entry-type":g(e),entry:l.value,type:"entry"},null,8,["entry-type","entry"])]),_:1}),t(y,{class:"children"},{default:s(()=>[(i(!0),V(T,null,w(g(e).children,n=>(i(),v(ie,{child:n,modelValue:l.value[n.childName],"onUpdate:modelValue":R=>l.value[n.childName]=R},null,8,["child","modelValue","onUpdate:modelValue"]))),256))]),_:1}),t(y,{class:"editLog vertical-align-end"},{default:s(()=>[t(ae,{class:"h-100"},{default:s(()=>[t(de,{"edit-log":a.value.editLog},null,8,["edit-log"])]),_:1})]),_:1}),t(ne,{loaded:!o.saving.value},null,8,["loaded"])]),_:1})):M("",!0)]),_:1}))}});export{Ee as default};
