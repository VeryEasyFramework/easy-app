import{C as K}from"./CardWidget-DGg9H3FA.js";import{d as L,o as d,c as y,w as n,b as t,e as h,C as v,f as U,a as b,q as P,p as V,z as w,F as E,s as T,t as C,l as g,g as G,v as q,B,x as A,E as W,h as M,L as H,j as J,i as D,A as Q,n as S}from"./index-BLUmWJ0B.js";import{_ as X}from"./LoaderOverlay.vue_vue_type_style_index_0_lang-DRGYiU51.js";import{_ as R,a as j,M as I}from"./ButtonIcon.vue_vue_type_script_setup_true_lang-Clz7Z40D.js";import{R as Y,_ as Z,a as O}from"./RecordAttendance-BiT_zv3e.js";import{a as x,l as ee,o as te,_ as le,g as ae,f as oe}from"./index-DBKjfLVL.js";import{_ as ne}from"./DisplayChoices.vue_vue_type_style_index_0_lang-aPVXZ_af.js";import"./FormBase.vue_vue_type_script_setup_true_lang-D-zhasFN.js";import"./TransitionList.vue_vue_type_style_index_0_lang-B0UJVPA5.js";import"./Button.vue_vue_type_script_setup_true_lang-Brrfl2U2.js";import"./InputData.vue_vue_type_script_setup_true_lang-DcFuWUzI.js";const ie=L({__name:"EntityInfo",props:{entityDef:{},record:{}},setup($){return(r,e)=>(d(),y(v,null,{default:n(()=>[t(v,{class:"col"},{default:n(()=>[e[0]||(e[0]=h("div",{class:"label"},"Created At:",-1)),t(x,{class:"label text-info-dark",value:r.record.createdAt},null,8,["value"])]),_:1}),t(v,{class:"col"},{default:n(()=>[e[1]||(e[1]=h("div",{class:"label"},"Last Updated:",-1)),t(x,{class:"label text-info-dark",value:r.record.updatedAt},null,8,["value"])]),_:1})]),_:1}))}}),se=L({__name:"EntityToolbar",props:{editMode:{type:Boolean}},emits:["edit","save","delete"],setup($,{emit:r}){const e=r,l=$;return ee(a=>{te(a,()=>{l.editMode&&e("save")})}),(a,i)=>(d(),y(v,{class:"toolbar col shrink"},{default:n(()=>[t(j,{speed:"fast"},{default:n(()=>[a.editMode?(d(),y(R,{key:0,icon:"save",size:"1",color:"success",onClick:i[0]||(i[0]=p=>a.$emit("save"))})):U("",!0)]),_:1}),t(j,{speed:"fast"},{default:n(()=>[a.editMode?(d(),y(R,{key:0,onClick:i[1]||(i[1]=p=>a.$emit("delete")),icon:"delete",size:"1",color:"error"})):U("",!0)]),_:1}),t(R,{onClick:i[2]||(i[2]=p=>a.$emit("edit",!a.editMode)),icon:a.editMode?"edit_off":"edit",label:"Edit Mode",color:"warning",size:"1"},null,8,["icon"])]),_:1}))}}),de={class:"time italic"},re=L({__name:"EntityEditLog",props:{editLog:{}},setup($){const r={create:"created",update:"updated",delete:"deleted"},e=b(),l=b(!1);return(a,i)=>{const p=P("RouterLink");return d(),y(v,{class:"edit-log row shrink gap-3 position-relative"},{default:n(()=>[i[1]||(i[1]=h("div",{class:"title-5"},"Edit Log",-1)),t(T,{class:"edit-log-container row shrink gap-3"},{default:n(()=>[(d(!0),V(E,null,w(a.editLog,u=>(d(),y(v,{class:"edit-log-entry col shrink text-small",key:u.id},{default:n(()=>[h("div",de,C(g(ae)(u.createdAt,{format:"pretty"})),1),t(p,{class:"user-link",to:`/entity/user/${u.user}`},{default:n(()=>[G(C(u.userFullName),1)]),_:2},1032,["to"]),h("div",{class:q(u.action)},C(r[u.action]),3),h("div",null,C(u.recordTitle||u.recordId),1),t(I,{class:"cursor-pointer",icon:"info",onClick:k=>{e.value=u,l.value=!0}},null,8,["onClick"])]),_:2},1024))),128))]),_:1}),e.value&&l.value?(d(),y(v,{key:0,class:"position-absolute w-100 h-100 top left row shrink"},{default:n(()=>{var u;return[t(I,{class:"cursor-pointer horizontal-align-self-end",icon:"close",onClick:i[0]||(i[0]=k=>l.value=!1)}),t(le,{value:(u=e.value)==null?void 0:u.editData},null,8,["value"])]}),_:1})):U("",!0)]),_:1})}}}),ue=L({__name:"ChildInput",props:{modelValue:{},titleValue:{},field:{},editable:{type:Boolean},error:{},focus:{type:Boolean},placeholder:{}},emits:["selected","update:modelValue","update:titleValue"],setup($,{emit:r}){const e=$,l=r,a=B({get:()=>e.modelValue,set:p=>{l("update:modelValue",p)}}),i=B({get:()=>e.titleValue,set:p=>{l("update:titleValue",p)}});return A(()=>{console.log(e.modelValue),console.log(e.field.key)}),(p,u)=>(d(),y(W(g(oe)[e.field.fieldType]),{modelValue:a.value,"onUpdate:modelValue":u[0]||(u[0]=k=>a.value=k),field:e.field,error:e.error,editable:e.editable,placeholder:p.placeholder,focus:e.focus,noLabel:!0,onSelected:u[1]||(u[1]=k=>p.$emit("selected",k)),titleValue:i.value,"onUpdate:titleValue":u[2]||(u[2]=k=>i.value=k)},null,40,["modelValue","field","error","editable","placeholder","focus","titleValue"]))}}),ce={class:"title-5 text-primary"},fe=L({__name:"ChildList",props:{child:{},modelValue:{}},emits:["update:modelValue"],setup($,{emit:r}){const e=$,l=r,a=b([]);A(()=>{a.value=e.modelValue});const i=B(()=>{const _=e.child.fields.filter(f=>f.connectionTitleField).map(f=>f.connectionTitleField);return e.child.fields.filter(f=>!(_.includes(f.key)||f.hidden))});function p(){const _=a.value.map((f,c)=>(f.order=c,f));a.value=_}async function u(_,f,c){const m=e.child.fields.filter(o=>{var F;return((F=o.fetchOnCreate)==null?void 0:F.idKey)===f.key});if(m.length===0)return;const s=await M.getEntity(f.connectionEntity,_);m.forEach(o=>{c[o.key]=s[o.fetchOnCreate.field]})}function k(_){a.value=a.value.filter((f,c)=>c!==_),p(),l("update:modelValue",a.value)}function z(){const _=e.child.fields,f={id:"",order:a.value.length};_.forEach(c=>{f[c.key]=c.defaultValue}),a.value.push(f),p(),l("update:modelValue",a.value)}return(_,f)=>(d(),y(v,{class:"row shrink child-list"},{default:n(()=>[t(v,{class:"col shrink vertical-align-center"},{default:n(()=>[h("div",ce,C(_.child.label),1),t(R,{class:"add-button",icon:"add",size:"0.8",onClick:z})]),_:1}),t(T,{class:"row shrink card dark"},{default:n(()=>[t(v,{class:"col"},{default:n(()=>[(d(!0),V(E,null,w(i.value,c=>(d(),V("div",{class:"label",key:c.key},C(c.label),1))),128))]),_:1}),(d(!0),V(E,null,w(a.value,(c,m)=>(d(),y(v,{class:"col child-record card",key:c.id},{default:n(()=>[(d(!0),V(E,null,w(i.value,s=>(d(),V("div",{key:`${c.id}${s.key}`},[(d(),y(ue,{field:s,onSelected:o=>u(o,s,c),modelValue:c[s.key],"onUpdate:modelValue":o=>c[s.key]=o,titleValue:c[s.connectionTitleField?s.connectionTitleField:""],"onUpdate:titleValue":o=>c[s.connectionTitleField?s.connectionTitleField:""]=o,key:s.key},null,8,["field","onSelected","modelValue","onUpdate:modelValue","titleValue","onUpdate:titleValue"]))]))),128)),h("div",null,C(c.order),1),t(R,{icon:"delete",onClick:s=>k(m),size:"0.8"},null,8,["onClick"])]),_:2},1024))),128))]),_:1})]),_:1}))}}),pe={class:"title-4"},ve={class:"text-small italic text-primary-bright"},me={key:0,class:"choice"},ye={class:"fit-content"},Le=L({__name:"EntityRecordView",props:{entity:{},id:{}},setup($){const r=$;let e={};const l=b({}),a=b({editLog:[]}),i={loaded:b(!1),saving:b(!1)},p=b(!1);async function u(){i.loaded.value=!1,l.value=await M.getEntity(r.entity,r.id),i.loaded.value=!0}async function k(){a.value=await M.getRecordInfo(r.entity,r.id)}async function z(){if(!l.value)return;i.saving.value=!0;const m=l.value;await M.updateEntity(r.entity,m.id,m),i.saving.value=!1}async function _(){l.value&&(i.saving.value=!0,await M.deleteEntity(r.entity,l.value.id),i.saving.value=!1,await D.push(`/entity/${r.entity}`))}function f(m,s){const o=s.user,F=s.users;c.value=F;const N=m==="join"?"joined":"left";S({message:`${o.firstName} ${N} the record`,title:`User ${N}`,type:m==="join"?"success":"warning"})}const c=b([]);return H(r.entity,r.id,(m,s)=>{switch(console.log("event",m,s),m){case"update":console.log(s),console.log(Object.keys(s)),l.value=s,S({message:`${e.config.label} ${l.value[e.config.titleField||"id"]} was updated`,title:`${e.config.label} Updated`,type:"success"});break;case"delete":D.push(`/entity/${r.entity}`);break;case"join":f("join",s);break;case"leave":f("leave",s)}}),J(()=>{if(!r.id||!r.entity)return D.push("/entity");const m=Q.getDef(r.entity);if(!m)return D.push("/entity");e=m}),A(async()=>{await u(),await k()}),(m,s)=>(d(),y(j,null,{default:n(()=>[i.loaded.value?(d(),y(T,{key:0,class:"position-relative entity-record-grid"},{default:n(()=>[t(v,{class:"top-bar col shrink vertical-align-center horizontal-align-between"},{default:n(()=>[t(v,null,{default:n(()=>[h("div",pe,C(l.value[g(e).config.titleField||"id"]),1),h("div",ve,C(l.value.id),1),g(e).statusField?(d(),V("div",me,[t(ne,{value:l.value[g(e).statusField.key],field:g(e).statusField},null,8,["value","field"])])):U("",!0)]),_:1}),t(v,{class:"col shrink"},{default:n(()=>[h("div",ye,[t(Y,{users:c.value},null,8,["users"])]),t(se,{editMode:p.value,onSave:z,onDelete:_,onEdit:s[0]||(s[0]=o=>p.value=o)},null,8,["editMode"])]),_:1})]),_:1}),t(T,{class:"fields"},{default:n(()=>[t(v,{class:"row shrink"},{default:n(()=>[(d(!0),V(E,null,w(g(e).fieldGroups.filter(o=>o.key!=="default"),o=>(d(),y(O,{edit:p.value,group:o,record:l.value,key:o.key},null,8,["edit","group","record"]))),128)),(d(!0),V(E,null,w(g(e).fieldGroups.filter(o=>o.key==="default"),o=>(d(),y(O,{edit:p.value,group:o,record:l.value,key:o.key},null,8,["edit","group","record"]))),128))]),_:1})]),_:1}),t(v,{class:"info"},{default:n(()=>[t(ie,{entityDef:g(e),record:l.value},null,8,["entityDef","record"])]),_:1}),t(v,{class:"actions"},{default:n(()=>[t(Z,{entityDef:g(e),record:l.value,type:"entity"},null,8,["entityDef","record"])]),_:1}),t(v,{class:"children"},{default:n(()=>[(d(!0),V(E,null,w(g(e).children,o=>(d(),y(fe,{child:o,modelValue:l.value[o.childName],"onUpdate:modelValue":F=>l.value[o.childName]=F},null,8,["child","modelValue","onUpdate:modelValue"]))),256))]),_:1}),t(v,{class:"editLog vertical-align-end"},{default:n(()=>[t(K,{class:"h-100"},{default:n(()=>[t(re,{"edit-log":a.value.editLog},null,8,["edit-log"])]),_:1})]),_:1}),t(X,{loaded:!i.saving.value},null,8,["loaded"])]),_:1})):U("",!0)]),_:1}))}});export{Le as default};
