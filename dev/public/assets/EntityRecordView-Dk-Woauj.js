import{C as B}from"./CardWidget-Cv_RxGrY.js";import{d as M,a as h,x as D,o as i,c as k,w as o,e as g,b as t,p as b,z as F,F as A,C as v,s as R,t as w,h as L,n as T,E as W,l as C,f as U,q as K,g as G,v as X,B as N,m as j,_ as Y,L as J,j as Q,i as P,A as Z}from"./index-hlzIjE76.js";import{_ as ee}from"./LoaderOverlay.vue_vue_type_style_index_0_lang-DPjkkdp0.js";import{_ as x,a as S,M as z}from"./ButtonIcon.vue_vue_type_script_setup_true_lang-DedLdgYS.js";import{_ as te,l as le,o as ae}from"./ModalView.vue_vue_type_style_index_0_lang-DKM3DQX9.js";import{_ as oe}from"./FormBase.vue_vue_type_script_setup_true_lang-shujbrzg.js";import{f as H,a as q,_ as ne,g as se,b as ie}from"./index-Bc-B_4EF.js";import{_ as O}from"./EntityFieldGroup.vue_vue_type_style_index_0_lang-B45RDhcl.js";import{a as re,_ as ue}from"./TransitionList.vue_vue_type_style_index_0_lang-en7sij_f.js";import"./Button.vue_vue_type_script_setup_true_lang-BEx5Lo2r.js";import"./InputData.vue_vue_type_script_setup_true_lang-DfK0UIer.js";import"./EasyInput.vue_vue_type_script_setup_true_lang-4Hy4SXhy.js";const de={class:"title-5 text-accent"},ce={class:"text-small italic"},fe={class:"title-4 text-center"},pe=M({__name:"EntityActions",props:{entityDef:{},record:{}},setup(V){const u=V,l=h([]),a=h({key:"",label:"",description:"",params:[],action:()=>{}}),n=h({}),r=h(!1);D(()=>{l.value=u.entityDef.actions.filter(_=>!_.private)});async function m(_){if(a.value=_,_.params&&_.params.length>0){n.value={},_.params.forEach(d=>{n.value[d.key]={error:"",value:null}}),r.value=!0;return}await p(_)}async function p(_){if(!$(_,n.value))return;const d={};for(const s in n.value)d[s]=n.value[s].value;const e=await L.runEntityAction(u.entityDef.entityId,u.record.id,_.key,d);T({title:`Action ${_.label||_.key} completed`,message:e.message||e||"Action completed",type:"success"}),n.value={},a.value={key:"",label:"",description:"",params:[],action:()=>{}},r.value=!1}function $(_,d){let e=!1;if(!_.params)return!0;for(const s of _.params){if(s.required&&!d[s.key].value){d[s.key].error="Please provide a value",e=!0;continue}d[s.key].error=""}return!e}return(_,d)=>(i(),k(R,{class:"row shrink"},{default:o(()=>[d[3]||(d[3]=g("div",null,[g("div",{class:"title-4"},"Actions")],-1)),t(v,{class:"row shrink"},{default:o(()=>[(i(!0),b(A,null,F(l.value,e=>(i(),k(B,{key:e.key},{default:o(()=>[t(v,{class:"col-2 shrink vertical-align-center"},{default:o(()=>[t(x,{icon:"play_arrow",color:"secondary",onClick:s=>m(e),label:e.label,key:"play"},null,8,["onClick","label"]),t(v,null,{default:o(()=>[g("div",de,w(e.label),1),g("div",ce,w(e.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),t(te,{modelValue:r.value,"onUpdate:modelValue":d[2]||(d[2]=e=>r.value=e)},{default:o(()=>[t(R,{class:"row row-gap-4"},{default:o(()=>[g("div",fe,w(a.value.label||a.value.key),1),t(oe,{name:"actionParamsForm",onSubmitted:d[1]||(d[1]=async()=>await p(a.value))},{default:o(()=>[t(v,{class:"row row-gap-4"},{default:o(()=>[t(v,null,{default:o(()=>[(i(!0),b(A,null,F(a.value.params,e=>(i(),b("div",{key:e.key},[(i(),k(W(C(H)[e.fieldType]),{label:e.key,required:e.required,error:n.value[e.key].error,modelValue:n.value[e.key].value,"onUpdate:modelValue":s=>n.value[e.key].value=s},null,8,["label","required","error","modelValue","onUpdate:modelValue"]))]))),128))]),_:1}),t(v,{class:"col shrink horizontal-align-center gap-3"},{default:o(()=>[t(x,{icon:"cancel",color:"error",onClick:d[0]||(d[0]=e=>r.value=!1),label:"Cancel"}),t(x,{icon:"play_arrow",type:"submit",color:"secondary",label:a.value.label},null,8,["label"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),ve=M({__name:"EntityInfo",props:{entityDef:{},record:{}},setup(V){return(u,l)=>(i(),k(v,null,{default:o(()=>[t(v,{class:"col"},{default:o(()=>[l[0]||(l[0]=g("div",{class:"label"},"Created At:",-1)),t(q,{class:"label text-info-dark",value:u.record.createdAt},null,8,["value"])]),_:1}),t(v,{class:"col"},{default:o(()=>[l[1]||(l[1]=g("div",{class:"label"},"Last Updated:",-1)),t(q,{class:"label text-info-dark",value:u.record.updatedAt},null,8,["value"])]),_:1})]),_:1}))}}),me=M({__name:"EntityToolbar",props:{editMode:{type:Boolean}},emits:["edit","save","delete"],setup(V,{emit:u}){const l=u,a=V;return le(n=>{ae(n,()=>{a.editMode&&l("save")})}),(n,r)=>(i(),k(v,{class:"toolbar col shrink"},{default:o(()=>[t(S,{speed:"fast"},{default:o(()=>[n.editMode?(i(),k(x,{key:0,icon:"save",size:"1",color:"success",onClick:r[0]||(r[0]=m=>n.$emit("save"))})):U("",!0)]),_:1}),t(S,{speed:"fast"},{default:o(()=>[n.editMode?(i(),k(x,{key:0,onClick:r[1]||(r[1]=m=>n.$emit("delete")),icon:"delete",size:"1",color:"error"})):U("",!0)]),_:1}),t(x,{onClick:r[2]||(r[2]=m=>n.$emit("edit",!n.editMode)),icon:n.editMode?"edit_off":"edit",label:"Edit Mode",color:"warning",size:"1"},null,8,["icon"])]),_:1}))}}),ye={class:"time italic"},_e=M({__name:"EntityEditLog",props:{editLog:{}},setup(V){const u={create:"created",update:"updated",delete:"deleted"},l=h(),a=h(!1);return(n,r)=>{const m=K("RouterLink");return i(),k(v,{class:"edit-log row shrink gap-3 position-relative"},{default:o(()=>[r[1]||(r[1]=g("div",{class:"title-5"},"Edit Log",-1)),t(R,{class:"edit-log-container row shrink gap-3"},{default:o(()=>[(i(!0),b(A,null,F(n.editLog,p=>(i(),k(v,{class:"edit-log-entry col shrink text-small",key:p.id},{default:o(()=>[g("div",ye,w(C(se)(p.createdAt,{format:"pretty"})),1),t(m,{class:"user-link",to:`/entity/user/${p.user}`},{default:o(()=>[G(w(p.userFullName),1)]),_:2},1032,["to"]),g("div",{class:X(p.action)},w(u[p.action]),3),g("div",null,w(p.recordTitle||p.recordId),1),t(z,{class:"cursor-pointer",icon:"info",onClick:$=>{l.value=p,a.value=!0}},null,8,["onClick"])]),_:2},1024))),128))]),_:1}),l.value&&a.value?(i(),k(v,{key:0,class:"position-absolute w-100 h-100 top left row shrink"},{default:o(()=>{var p;return[t(z,{class:"cursor-pointer horizontal-align-self-end",icon:"close",onClick:r[0]||(r[0]=$=>a.value=!1)}),t(ne,{value:(p=l.value)==null?void 0:p.editData},null,8,["value"])]}),_:1})):U("",!0)]),_:1})}}}),ke=M({__name:"ChildInput",props:{modelValue:{},titleValue:{},field:{},editable:{type:Boolean},error:{},focus:{type:Boolean},placeholder:{}},emits:["selected","update:modelValue","update:titleValue"],setup(V,{emit:u}){const l=V,a=u,n=N({get:()=>l.modelValue,set:m=>{a("update:modelValue",m)}}),r=N({get:()=>l.titleValue,set:m=>{a("update:titleValue",m)}});return D(()=>{console.log(l.modelValue),console.log(l.field.key)}),(m,p)=>(i(),k(W(C(H)[l.field.fieldType]),{modelValue:n.value,"onUpdate:modelValue":p[0]||(p[0]=$=>n.value=$),field:l.field,error:l.error,editable:l.editable,placeholder:m.placeholder,focus:l.focus,noLabel:!0,onSelected:p[1]||(p[1]=$=>m.$emit("selected",$)),titleValue:r.value,"onUpdate:titleValue":p[2]||(p[2]=$=>r.value=$)},null,40,["modelValue","field","error","editable","placeholder","focus","titleValue"]))}}),ge={class:"title-5 text-primary"},he=M({__name:"ChildList",props:{child:{},modelValue:{}},emits:["update:modelValue"],setup(V,{emit:u}){const l=V,a=u,n=h([]);D(()=>{n.value=l.modelValue});const r=N(()=>{const d=l.child.fields.filter(e=>e.connectionTitleField).map(e=>e.connectionTitleField);return l.child.fields.filter(e=>!(d.includes(e.key)||e.hidden))});function m(){const d=n.value.map((e,s)=>(e.order=s,e));n.value=d}async function p(d,e,s){const y=l.child.fields.filter(c=>{var E;return((E=c.fetchOnCreate)==null?void 0:E.idKey)===e.key});if(y.length===0)return;const f=await L.getEntity(e.connectionEntity,d);y.forEach(c=>{s[c.key]=f[c.fetchOnCreate.field]})}function $(d){n.value=n.value.filter((e,s)=>s!==d),m(),a("update:modelValue",n.value)}function _(){const d=l.child.fields,e={id:"",order:n.value.length};d.forEach(s=>{e[s.key]=s.defaultValue}),n.value.push(e),m(),a("update:modelValue",n.value)}return(d,e)=>(i(),k(v,{class:"row shrink child-list"},{default:o(()=>[t(v,{class:"col shrink vertical-align-center"},{default:o(()=>[g("div",ge,w(d.child.label),1),t(x,{class:"add-button",icon:"add",size:"0.8",onClick:_})]),_:1}),t(R,{class:"row shrink card dark"},{default:o(()=>[t(v,{class:"col"},{default:o(()=>[(i(!0),b(A,null,F(r.value,s=>(i(),b("div",{class:"label",key:s.key},w(s.label),1))),128))]),_:1}),(i(!0),b(A,null,F(n.value,(s,y)=>(i(),k(v,{class:"col child-record card",key:s.id},{default:o(()=>[(i(!0),b(A,null,F(r.value,f=>(i(),b("div",{key:`${s.id}${f.key}`},[(i(),k(ke,{field:f,onSelected:c=>p(c,f,s),modelValue:s[f.key],"onUpdate:modelValue":c=>s[f.key]=c,titleValue:s[f.connectionTitleField?f.connectionTitleField:""],"onUpdate:titleValue":c=>s[f.connectionTitleField?f.connectionTitleField:""]=c,key:f.key},null,8,["field","onSelected","modelValue","onUpdate:modelValue","titleValue","onUpdate:titleValue"]))]))),128)),g("div",null,w(s.order),1),t(x,{icon:"delete",onClick:f=>$(y),size:"0.8"},null,8,["onClick"])]),_:2},1024))),128))]),_:1})]),_:1}))}}),$e={class:"label"},be=M({__name:"Popover",props:{text:{},wait:{},position:{}},setup(V){const u=V,l=h("0px"),a=h("0px");h(null);const n=h();D(()=>{});const r=h(!1);function m(){var e;(e=n.value)==null||e.showPopover()}function p(){var e;(e=n.value)==null||e.hidePopover()}function $(e){var s,y;r.value=!0,d((y=(s=e.target)==null?void 0:s.firstElementChild)==null?void 0:y.getBoundingClientRect(),n.value),setTimeout(()=>{r.value&&m()},u.wait??300)}function _(){r.value=!1,setTimeout(()=>{p()},u.wait??300)}function d(e,s){if(!e)return;const y=s.offsetHeight,f=s.offsetWidth;let c,E;window.innerHeight-(e==null?void 0:e.top)<y?E=(e==null?void 0:e.top)-y:E=e==null?void 0:e.top,window.innerWidth-(e==null?void 0:e.left)<f?c=(e==null?void 0:e.left)+f+5:c=(e==null?void 0:e.left)+(e==null?void 0:e.width)+5,s.style.top=`${E}px`,s.style.left=`${c}px`,l.value=`${E}px`,a.value=`${c}px`}return(e,s)=>(i(),b(A,null,[g("div",{style:{display:"contents"},onMouseenter:$,onMouseleave:_},[j(e.$slots,"default")],32),g("div",{ref_key:"popover",ref:n,class:"popover",popover:""},[j(e.$slots,"popover",{},()=>[t(B,{class:"shadow"},{default:o(()=>[g("div",$e,w(e.text),1)]),_:1})])],512)],64))}}),Ve=M({__name:"RecordAttendance",props:{users:{}},setup(V){return(u,l)=>(i(),k(v,{class:"col shrink overflow-visible"},{default:o(()=>[t(re,null,{default:o(()=>[(i(!0),b(A,null,F(u.users,a=>(i(),k(be,{text:`${a.firstName} ${a.lastName}`,key:a.id},{default:o(()=>[(i(),k(v,{class:"col cursor-pointer label overflow-visible avatar shrink vertical-align-center bg-primary border px-2",key:a.id},{default:o(()=>[t(z,{icon:"person",class:"avatar"}),g("div",null,w(C(ie)(`${a.firstName} ${a.lastName}`,"initials")),1)]),_:2},1024))]),_:2},1032,["text"]))),128))]),_:1})]),_:1}))}}),we=Y(Ve,[["__scopeId","data-v-02ca1f19"]]),Ce={class:"title-4"},Ee={class:"text-small italic text-primary-bright"},Ae={key:0,class:"choice"},Fe={class:"fit-content"},Ie=M({__name:"EntityRecordView",props:{entity:{},id:{}},setup(V){const u=V;let l={};const a=h({}),n=h({editLog:[]}),r={loaded:h(!1),saving:h(!1)},m=h(!1);async function p(){r.loaded.value=!1,a.value=await L.getEntity(u.entity,u.id),r.loaded.value=!0}async function $(){n.value=await L.getRecordInfo(u.entity,u.id)}async function _(){if(!a.value)return;r.saving.value=!0;const y=a.value;await L.updateEntity(u.entity,y.id,y),r.saving.value=!1}async function d(){a.value&&(r.saving.value=!0,await L.deleteEntity(u.entity,a.value.id),r.saving.value=!1,await P.push(`/entity/${u.entity}`))}function e(y,f){const c=f.user,E=f.users;s.value=E;const I=y==="join"?"joined":"left";T({message:`${c.firstName} ${I} the record`,title:`User ${I}`,type:y==="join"?"success":"warning"})}const s=h([]);return J(u.entity,u.id,(y,f)=>{switch(console.log("event",y,f),y){case"update":console.log(f),console.log(Object.keys(f)),a.value=f,T({message:`${l.config.label} ${a.value[l.config.titleField||"id"]} was updated`,title:`${l.config.label} Updated`,type:"success"});break;case"delete":P.push(`/entity/${u.entity}`);break;case"join":e("join",f);break;case"leave":e("leave",f)}}),Q(()=>{if(!u.id||!u.entity)return P.push("/entity");const y=Z.getDef(u.entity);if(!y)return P.push("/entity");l=y}),D(async()=>{await p(),await $()}),(y,f)=>(i(),k(S,null,{default:o(()=>[r.loaded.value?(i(),k(R,{key:0,class:"position-relative entity-record-grid"},{default:o(()=>[t(v,{class:"top-bar col shrink vertical-align-center horizontal-align-between"},{default:o(()=>[t(v,null,{default:o(()=>[g("div",Ce,w(a.value[C(l).config.titleField||"id"]),1),g("div",Ee,w(a.value.id),1),C(l).statusField?(i(),b("div",Ae,[t(ue,{value:a.value[C(l).statusField.key],field:C(l).statusField},null,8,["value","field"])])):U("",!0)]),_:1}),t(v,{class:"col shrink"},{default:o(()=>[g("div",Fe,[t(we,{users:s.value},null,8,["users"])]),t(me,{editMode:m.value,onSave:_,onDelete:d,onEdit:f[0]||(f[0]=c=>m.value=c)},null,8,["editMode"])]),_:1})]),_:1}),t(R,{class:"fields"},{default:o(()=>[t(v,{class:"row shrink"},{default:o(()=>[(i(!0),b(A,null,F(C(l).fieldGroups.filter(c=>c.key!=="default"),c=>(i(),k(O,{edit:m.value,group:c,record:a.value,key:c.key},null,8,["edit","group","record"]))),128)),(i(!0),b(A,null,F(C(l).fieldGroups.filter(c=>c.key==="default"),c=>(i(),k(O,{edit:m.value,group:c,record:a.value,key:c.key},null,8,["edit","group","record"]))),128))]),_:1})]),_:1}),t(v,{class:"info"},{default:o(()=>[t(ve,{entityDef:C(l),record:a.value},null,8,["entityDef","record"])]),_:1}),t(v,{class:"actions"},{default:o(()=>[t(pe,{entityDef:C(l),record:a.value},null,8,["entityDef","record"])]),_:1}),t(v,{class:"children"},{default:o(()=>[(i(!0),b(A,null,F(C(l).children,c=>(i(),k(he,{child:c,modelValue:a.value[c.childName],"onUpdate:modelValue":E=>a.value[c.childName]=E},null,8,["child","modelValue","onUpdate:modelValue"]))),256))]),_:1}),t(v,{class:"editLog vertical-align-end"},{default:o(()=>[t(B,{class:"h-100"},{default:o(()=>[t(_e,{"edit-log":n.value.editLog},null,8,["edit-log"])]),_:1})]),_:1}),t(ee,{loaded:!r.saving.value},null,8,["loaded"])]),_:1})):U("",!0)]),_:1}))}});export{Ie as default};
