import{C as z}from"./CardWidget-DaiIHUe1.js";import{d as V,n as k,q as U,o as r,c as f,w as a,b as p,a as e,i as w,v as C,F as E,C as u,l as D,t as g,B as A,I as q,y as P,m as b,j as F,z as x,p as N,k as G,e as K,g as j,f as L,x as O}from"./index-BgLTC03-.js";import{_ as W}from"./LoaderOverlay.vue_vue_type_style_index_0_lang-m-J0VXif.js";import{_ as h,a as I,M as B}from"./ButtonIcon.vue_vue_type_script_setup_true_lang-Cv5SDFW7.js";import{_ as H,f as S,l as J,o as Q,a as X,g as Y}from"./index-FkZDjgsL.js";import{_ as Z}from"./FormBase.vue_vue_type_script_setup_true_lang-Bd1KSvEf.js";import{_ as R,d as ee}from"./index-2Ud1_r45.js";import{a as te}from"./index-WTZV_Mn7.js";import"./InputPassword.vue_vue_type_script_setup_true_lang-BAdIyg2q.js";const le={class:"title-5 text-accent"},ae={class:"text-small italic"},oe={class:"title-4 text-center"},se=V({__name:"EntityActions",props:{entityDef:{},record:{}},setup($){const n=$,i=k([]),l=k({key:"",label:"",description:"",params:[],action:()=>{}}),s=k({}),t=k(!1);U(()=>{i.value=n.entityDef.actions.filter(c=>!c.private)});async function y(c){if(l.value=c,c.params&&c.params.length>0){s.value={},c.params.forEach(d=>{s.value[d.key]={error:"",value:null}}),t.value=!0;return}await v(c)}async function v(c){if(!M(c,s.value))return;const d={};for(const m in s.value)d[m]=s.value[m].value;const o=await A.runEntityAction(n.entityDef.entityId,n.record.id,c.key,d);q({title:`Action ${c.label||c.key} completed`,message:o.message||o||"Action completed",type:"success"}),s.value={},l.value={key:"",label:"",description:"",params:[],action:()=>{}},t.value=!1}function M(c,d){let o=!1;if(!c.params)return!0;for(const m of c.params){if(m.required&&!d[m.key].value){d[m.key].error="Please provide a value",o=!0;continue}d[m.key].error=""}return!o}return(c,d)=>(r(),f(D,{class:"row shrink"},{default:a(()=>[d[3]||(d[3]=p("div",null,[p("div",{class:"title-4"},"Actions")],-1)),e(u,{class:"row shrink"},{default:a(()=>[(r(!0),w(E,null,C(i.value,o=>(r(),f(z,{key:o.key},{default:a(()=>[e(u,{class:"col-2 shrink vertical-align-center"},{default:a(()=>[e(h,{icon:"play_arrow",color:"secondary",onClick:m=>y(o),label:o.label,key:"play"},null,8,["onClick","label"]),e(u,null,{default:a(()=>[p("div",le,g(o.label),1),p("div",ae,g(o.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),e(H,{modelValue:t.value,"onUpdate:modelValue":d[2]||(d[2]=o=>t.value=o)},{default:a(()=>[e(D,{class:"row row-gap-4"},{default:a(()=>[p("div",oe,g(l.value.label||l.value.key),1),e(Z,{name:"actionParamsForm",onSubmitted:d[1]||(d[1]=async()=>await v(l.value))},{default:a(()=>[e(u,{class:"row row-gap-4"},{default:a(()=>[e(u,null,{default:a(()=>[(r(!0),w(E,null,C(l.value.params,o=>(r(),w("div",{key:o.key},[(r(),f(P(b(S)[o.fieldType]),{label:o.key,required:o.required,error:s.value[o.key].error,modelValue:s.value[o.key].value,"onUpdate:modelValue":m=>s.value[o.key].value=m},null,8,["label","required","error","modelValue","onUpdate:modelValue"]))]))),128))]),_:1}),e(u,{class:"col shrink horizontal-align-center gap-3"},{default:a(()=>[e(h,{icon:"cancel",color:"error",onClick:d[0]||(d[0]=o=>t.value=!1),label:"Cancel"}),e(h,{icon:"play_arrow",type:"submit",color:"secondary",label:l.value.label},null,8,["label"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),ne=V({__name:"EntityInfo",props:{entityDef:{},record:{}},setup($){return(n,i)=>(r(),f(u,null,{default:a(()=>[e(u,{class:"col"},{default:a(()=>[i[0]||(i[0]=p("div",{class:"label"},"Created At:",-1)),e(R,{class:"label text-info-dark",value:n.record.createdAt},null,8,["value"])]),_:1}),e(u,{class:"col"},{default:a(()=>[i[1]||(i[1]=p("div",{class:"label"},"Last Updated:",-1)),e(R,{class:"label text-info-dark",value:n.record.updatedAt},null,8,["value"])]),_:1})]),_:1}))}}),ie=V({__name:"EntityToolbar",props:{editMode:{type:Boolean}},emits:["edit","save","delete"],setup($,{emit:n}){const i=n,l=$;return J(s=>{Q(s,()=>{l.editMode&&i("save")})}),(s,t)=>(r(),f(u,{class:"toolbar col shrink"},{default:a(()=>[e(I,{speed:"fast"},{default:a(()=>[s.editMode?(r(),f(h,{key:0,icon:"save",size:"1",color:"success",onClick:t[0]||(t[0]=y=>s.$emit("save"))})):F("",!0)]),_:1}),e(I,{speed:"fast"},{default:a(()=>[s.editMode?(r(),f(h,{key:0,onClick:t[1]||(t[1]=y=>s.$emit("delete")),icon:"delete",size:"1",color:"error"})):F("",!0)]),_:1}),e(h,{onClick:t[2]||(t[2]=y=>s.$emit("edit",!s.editMode)),icon:s.editMode?"edit_off":"edit",label:"Edit Mode",color:"warning",size:"1"},null,8,["icon"])]),_:1}))}}),re={class:"title-4 text-primary"},ue={class:"label"},T=V({__name:"EntityFieldGroup",props:{group:{},edit:{type:Boolean},record:{}},setup($){const n=$,i=x(()=>n.group.fields.filter(l=>{var s;return!(l.hidden||(s=l.fetchOptions)!=null&&s.thisIdKey)}));return(l,s)=>(r(),f(z,{class:""},{default:a(()=>[e(u,{class:"row shrink"},{default:a(()=>[p("div",re,g(l.group.title),1),e(u,{class:N(["group-fields col shrink column-gap-3 overflow-hidden",{edit:l.edit}])},{default:a(()=>[e(u,{class:"col-2 field-values"},{default:a(()=>[(r(!0),w(E,null,C(i.value,t=>(r(),f(u,{key:`${t.key}value`},{default:a(()=>[p("div",ue,g(t.label),1),l.edit?(r(),f(P(b(S)[t.fieldType]),{key:0,field:t,modelValue:l.record[t.key],"onUpdate:modelValue":y=>l.record[t.key]=y},null,8,["field","modelValue","onUpdate:modelValue"])):(r(),f(P(b(ee)[t.fieldType]),{key:1,field:t,titleValue:t.connectionTitleField?l.record[t.connectionTitleField]:"",format:"date",routePrefix:`/entity/${t.connectionEntity}`,value:l.record[t.key]},null,8,["field","titleValue","routePrefix","value"]))]),_:2},1024))),128))]),_:1})]),_:1},8,["class"])]),_:1})]),_:1}))}}),de={class:"time italic"},ce=V({__name:"EntityEditLog",props:{editLog:{}},setup($){const n={create:"created",update:"updated",delete:"deleted"},i=k(),l=k(!1);return(s,t)=>{const y=G("RouterLink");return r(),f(u,{class:"edit-log row shrink gap-3 position-relative"},{default:a(()=>[t[1]||(t[1]=p("div",{class:"title-5"},"Edit Log",-1)),e(D,{class:"edit-log-container row shrink gap-3"},{default:a(()=>[(r(!0),w(E,null,C(s.editLog,v=>(r(),f(u,{class:"edit-log-entry col shrink text-small",key:v.id},{default:a(()=>[p("div",de,g(b(Y)(v.createdAt,{format:"pretty"})),1),e(y,{class:"user-link",to:`/entity/user/${v.user}`},{default:a(()=>[K(g(v.userFullName),1)]),_:2},1032,["to"]),p("div",{class:N(v.action)},g(n[v.action]),3),p("div",null,g(v.recordTitle||v.recordId),1),e(B,{class:"cursor-pointer",icon:"info",onClick:M=>{i.value=v,l.value=!0}},null,8,["onClick"])]),_:2},1024))),128))]),_:1}),i.value&&l.value?(r(),f(u,{key:0,class:"position-absolute w-100 h-100 top left row shrink"},{default:a(()=>{var v;return[e(B,{class:"cursor-pointer horizontal-align-self-end",icon:"close",onClick:t[0]||(t[0]=M=>l.value=!1)}),e(X,{value:(v=i.value)==null?void 0:v.editData},null,8,["value"])]}),_:1})):F("",!0)]),_:1})}}}),fe={class:"title-4"},ve={class:"text-small italic text-primary-bright"},he=V({__name:"EntityRecordView",props:{entity:{},id:{}},setup($){const n=$;let i={};const l=k({}),s=k({editLog:[]}),t={loaded:k(!1),saving:k(!1)},y=k(!1);async function v(){t.loaded.value=!1,l.value=await A.getEntity(n.entity,n.id),t.loaded.value=!0}async function M(){s.value=await A.getRecordInfo(n.entity,n.id)}async function c(){if(!l.value)return;t.saving.value=!0;const o=l.value;await A.updateEntity(n.entity,o.id,o),t.saving.value=!1}async function d(){l.value&&(t.saving.value=!0,await A.deleteEntity(n.entity,l.value.id),t.saving.value=!1,await L.push(`/entity/${n.entity}`))}return te(n.entity,"update",async o=>{o.id===n.id&&(l.value=o,q({message:`${i.config.label} ${l.value[i.config.titleField||"id"]} was updated`,title:`${i.config.label} Updated`,type:"success"}))}),j(()=>{if(!n.id||!n.entity)return L.push("/entity");const o=O.getDef(n.entity);if(!o)return L.push("/entity");i=o}),U(async()=>{await v(),await M()}),(o,m)=>(r(),f(I,null,{default:a(()=>[t.loaded.value?(r(),f(D,{key:0,class:"position-relative entity-record-grid"},{default:a(()=>[e(u,{class:"top-bar col shrink vertical-align-center horizontal-align-between"},{default:a(()=>[e(u,null,{default:a(()=>[p("div",fe,g(l.value[b(i).config.titleField||"id"]),1),p("div",ve,g(l.value.id),1)]),_:1}),e(ie,{editMode:y.value,onSave:c,onDelete:d,onEdit:m[0]||(m[0]=_=>y.value=_)},null,8,["editMode"])]),_:1}),e(D,{class:"fields"},{default:a(()=>[e(u,{class:"row shrink"},{default:a(()=>[(r(!0),w(E,null,C(b(i).fieldGroups.filter(_=>_.key!=="default"),_=>(r(),f(T,{edit:y.value,group:_,record:l.value,key:_.key},null,8,["edit","group","record"]))),128)),(r(!0),w(E,null,C(b(i).fieldGroups.filter(_=>_.key==="default"),_=>(r(),f(T,{edit:y.value,group:_,record:l.value,key:_.key},null,8,["edit","group","record"]))),128))]),_:1})]),_:1}),e(u,{class:"info"},{default:a(()=>[e(ne,{entityDef:b(i),record:l.value},null,8,["entityDef","record"])]),_:1}),e(u,{class:"actions"},{default:a(()=>[e(se,{entityDef:b(i),record:l.value},null,8,["entityDef","record"])]),_:1}),e(u,{class:"editLog vertical-align-end"},{default:a(()=>[e(z,{class:"h-100"},{default:a(()=>[e(ce,{"edit-log":s.value.editLog},null,8,["edit-log"])]),_:1})]),_:1}),e(W,{loaded:!t.saving.value},null,8,["loaded"])]),_:1})):F("",!0)]),_:1}))}});export{he as default};
