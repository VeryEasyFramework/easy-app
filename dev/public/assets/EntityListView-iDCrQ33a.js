var te=Object.defineProperty;var le=(r,l,t)=>l in r?te(r,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[l]=t;var O=(r,l,t)=>le(r,typeof l!="symbol"?l+"":l,t);import{a as h,o as p,c,w as d,m as ae,C as B,b as m,g as M,j as N,k as z,h as y,t as E,l as P,M as T,L as S,p as oe,f as V,K as A,i as ne,N as ie,G as v,s as _,O as L,P as k,Q as re,R as se,e as ue,S as de,u as pe,U as me,V as fe,v as ce,q as F,_ as ye}from"./RootLayout.vue_vue_type_style_index_0_lang-C7NduuQ-.js";import{M as H,_ as ve,a as R,b as Z,e as he,l as be,T as Ve}from"./main-DT8Npkzz.js";import{C as G}from"./CardWidget-DR0gW1BQ.js";import{_ as Q,l as j,a as _e}from"./InputTimestamp.vue_vue_type_script_setup_true_lang-CDwwVY4G.js";import{a as ge,_ as W}from"./InputPassword.vue_vue_type_script_setup_true_lang-g-pVS4aG.js";import{_ as I}from"./InputWrapper.vue_vue_type_script_setup_true_lang-D2qf8GVU.js";const Le=h({__name:"ListDetailLayout",props:{maxWidth:{}},setup(r){return(l,t)=>(p(),c(B,{class:"list-detail",style:ae(l.maxWidth?`--max-width:${l.maxWidth}`:"")},{default:d(()=>[m(z,{class:"bg border"},{default:d(()=>[M(l.$slots,"list",{},()=>[t[0]||(t[0]=N("List"))])]),_:3}),m(z,{class:"bg border"},{default:d(()=>[M(l.$slots,"detail",{},()=>[t[1]||(t[1]=N("Detail"))])]),_:3})]),_:3},8,["style"]))}}),Ie={class:"text-small text-primary bold item-label"},qe={class:"text-small italic text-primary-bright"},$e=h({__name:"EntityListItem",props:{entityDef:{},record:{},active:{type:Boolean},fields:{}},emits:["select"],setup(r,{emit:l}){return(t,n)=>(p(),c(G,{class:oe(["full-width entity-list-item position-relative",{active:t.active}]),onClick:n[0]||(n[0]=a=>t.$emit("select",t.record.id))},{default:d(()=>[m(B,{class:"row shrink"},{default:d(()=>[m(B,{class:"col shrink horizontal-align-between"},{default:d(()=>[y("div",Ie,E(t.record[t.entityDef.config.titleField||"id"]),1)]),_:1}),m(B,{class:"col shrink"},{default:d(()=>[(p(!0),P(T,null,S(t.fields,a=>(p(),P("div",{key:a},[y("div",qe,E(t.record[a]),1)]))),128))]),_:1})]),_:1}),m(B,{class:"gap-2 pe-2 pt-1 dates col shrink position-absolute top right"},{default:d(()=>[m(B,{class:"col shrink text-tiny italic overflow-visible"},{default:d(()=>[m(H,{icon:"add",size:"0.6"}),m(Q,{value:t.record.createdAt,format:"compact"},null,8,["value"])]),_:1}),m(B,{class:"col shrink text-tiny italic overflow-visible"},{default:d(()=>[m(H,{icon:"update",size:"0.6"}),m(Q,{value:t.record.updatedAt,format:"compact"},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["class"]))}}),Be=h({__name:"ModalView",props:{modelValue:{type:Boolean}},emits:["update:modelValue","close"],setup(r,{emit:l}){function t(){i.value=!1,a("close")}const n=r,a=l,i=V({get:()=>n.modelValue,set:e=>{a("update:modelValue",e)}});return j(e=>{e.key==="Escape"&&t()}),(e,o)=>(p(),c(ie,{to:"#modals"},[m(ve,null,{default:d(()=>[i.value?(p(),c(B,{key:0,onClick:A(t,["self"]),class:"modal-wrapper z-max position-fixed top left vh-100 vw-100 horizontal-align-center vertical-align-center"},{default:d(()=>[m(G,null,{default:d(()=>[M(e.$slots,"default",{},()=>[o[0]||(o[0]=N(" modal "))])]),_:3})]),_:3})):ne("",!0)]),_:3})]))}}),ke=["name","disabled"],we=h({__name:"InputInt",props:{modelValue:{},label:{},error:{},name:{},required:{type:Boolean},readOnly:{type:Boolean},focus:{type:Boolean}},emits:["update:modelValue"],setup(r,{emit:l}){const t=r,n=l,a=v(),i=V({get:()=>t.modelValue,set:e=>{n("update:modelValue",e)}});return _(()=>{var e;t.focus&&((e=a.value)==null||e.focus())}),(e,o)=>(p(),c(I,{label:e.label,error:e.error,required:e.required,"read-only":e.readOnly},{default:d(()=>[L(y("input",{name:e.name,ref_key:"input",ref:a,type:"number","onUpdate:modelValue":o[0]||(o[0]=s=>i.value=s),disabled:e.readOnly},null,8,ke),[[k,i.value]])]),_:1},8,["label","error","required","read-only"]))}}),Oe=["name","disabled"],Ce=["value"],Ee=h({__name:"InputChoices",props:{modelValue:{},label:{},error:{},name:{},required:{type:Boolean},readOnly:{type:Boolean},focus:{type:Boolean},choices:{}},emits:["update:modelValue"],setup(r,{emit:l}){const t=r,n=l,a=v(),i=V({get:()=>t.modelValue,set:e=>{n("update:modelValue",e)}});return _(()=>{var e;t.focus&&((e=a.value)==null||e.focus())}),(e,o)=>(p(),c(I,{label:e.label,error:e.error,required:e.required,"read-only":e.readOnly},{default:d(()=>[L(y("select",{name:e.name,ref_key:"input",ref:a,"onUpdate:modelValue":o[0]||(o[0]=s=>i.value=s),disabled:e.readOnly},[(p(!0),P(T,null,S(e.choices,s=>(p(),P("option",{key:s.key,value:s.key},E(s.label),9,Ce))),128))],8,Oe),[[re,i.value]])]),_:1},8,["label","error","required","read-only"]))}}),Pe=["name","disabled"],Fe=h({__name:"InputText",props:{modelValue:{},label:{},error:{},name:{},required:{type:Boolean},readOnly:{type:Boolean},focus:{type:Boolean}},emits:["update:modelValue"],setup(r,{emit:l}){const t=r,n=l,a=v(),i=V({get:()=>t.modelValue,set:e=>{n("update:modelValue",e)}});return _(()=>{var e;t.focus&&((e=a.value)==null||e.focus())}),(e,o)=>(p(),c(I,{label:e.label,error:e.error,required:e.required,"read-only":e.readOnly},{default:d(()=>[L(y("textarea",{name:e.name,ref_key:"input",ref:a,"onUpdate:modelValue":o[0]||(o[0]=s=>i.value=s),disabled:e.readOnly},null,8,Pe),[[k,i.value]])]),_:1},8,["label","error","required","read-only"]))}}),De=["name","disabled"],Me=h({__name:"InputDate",props:{modelValue:{},label:{},error:{},name:{},required:{type:Boolean},readOnly:{type:Boolean},focus:{type:Boolean}},emits:["update:modelValue"],setup(r,{emit:l}){const t=r,n=l,a=v(),i=V({get:()=>t.modelValue,set:e=>{n("update:modelValue",e)}});return _(()=>{var e;t.focus&&((e=a.value)==null||e.focus())}),(e,o)=>(p(),c(I,{label:e.label,error:e.error,required:e.required,"read-only":e.readOnly},{default:d(()=>[L(y("input",{name:e.name,ref_key:"input",ref:a,type:"date","onUpdate:modelValue":o[0]||(o[0]=s=>i.value=s),disabled:e.readOnly},null,8,De),[[k,i.value]])]),_:1},8,["label","error","required","read-only"]))}}),ze=["name","disabled"],Te=h({__name:"InputBigInt",props:{modelValue:{},label:{},error:{},name:{},required:{type:Boolean},readOnly:{type:Boolean},focus:{type:Boolean}},emits:["update:modelValue"],setup(r,{emit:l}){const t=r,n=l,a=v(),i=V({get:()=>t.modelValue,set:e=>{n("update:modelValue",e)}});return _(()=>{var e;t.focus&&((e=a.value)==null||e.focus())}),(e,o)=>(p(),c(I,{label:e.label,error:e.error,required:e.required,"read-only":e.readOnly},{default:d(()=>[L(y("input",{name:e.name,ref_key:"input",ref:a,type:"number","onUpdate:modelValue":o[0]||(o[0]=s=>i.value=s),disabled:e.readOnly},null,8,ze),[[k,i.value]])]),_:1},8,["label","error","required","read-only"]))}}),Se=["name","disabled"],Ue=h({__name:"InputBoolean",props:{modelValue:{},label:{},error:{},name:{},required:{type:Boolean},readOnly:{type:Boolean},focus:{type:Boolean}},emits:["update:modelValue"],setup(r,{emit:l}){const t=r,n=l,a=v(),i=V({get:()=>t.modelValue,set:e=>{n("update:modelValue",e)}});return _(()=>{var e;t.focus&&((e=a.value)==null||e.focus())}),(e,o)=>(p(),c(I,{label:e.label,error:e.error,required:e.required,"read-only":e.readOnly},{default:d(()=>[L(y("input",{name:e.name,ref_key:"input",ref:a,type:"checkbox","onUpdate:modelValue":o[0]||(o[0]=s=>i.value=s),disabled:e.readOnly},null,8,Se),[[se,i.value]])]),_:1},8,["label","error","required","read-only"]))}}),Ne=["name","disabled"],Ae=h({__name:"InputMultiChoice",props:{modelValue:{},label:{},error:{},name:{},required:{type:Boolean},readOnly:{type:Boolean},focus:{type:Boolean}},emits:["update:modelValue"],setup(r,{emit:l}){const t=r,n=l,a=v(),i=V({get:()=>t.modelValue,set:e=>{n("update:modelValue",e)}});return _(()=>{var e;t.focus&&((e=a.value)==null||e.focus())}),(e,o)=>(p(),c(I,{label:e.label,error:e.error,required:e.required,"read-only":e.readOnly},{default:d(()=>[L(y("input",{name:e.name,ref_key:"input",ref:a,type:"text","onUpdate:modelValue":o[0]||(o[0]=s=>i.value=s),disabled:e.readOnly},null,8,Ne),[[k,i.value]])]),_:1},8,["label","error","required","read-only"]))}}),He=["name","disabled"],Re=h({__name:"InputEmail",props:{modelValue:{},label:{},error:{},name:{},required:{type:Boolean},readOnly:{type:Boolean},focus:{type:Boolean}},emits:["update:modelValue"],setup(r,{emit:l}){const t=r,n=l,a=v(),i=V({get:()=>t.modelValue,set:e=>{n("update:modelValue",e)}});return _(()=>{var e;t.focus&&((e=a.value)==null||e.focus())}),(e,o)=>(p(),c(I,{label:e.label,error:e.error,required:e.required,"read-only":e.readOnly},{default:d(()=>[L(y("input",{name:e.name,ref_key:"input",ref:a,type:"text","onUpdate:modelValue":o[0]||(o[0]=s=>i.value=s),disabled:e.readOnly},null,8,He),[[k,i.value]])]),_:1},8,["label","error","required","read-only"]))}}),We=["name","disabled"],Ge=h({__name:"InputImage",props:{modelValue:{},label:{},error:{},name:{},required:{type:Boolean},readOnly:{type:Boolean},focus:{type:Boolean}},emits:["update:modelValue"],setup(r,{emit:l}){const t=r,n=l,a=v(),i=V({get:()=>t.modelValue,set:e=>{n("update:modelValue",e)}});return _(()=>{var e;t.focus&&((e=a.value)==null||e.focus())}),(e,o)=>(p(),c(I,{label:e.label,error:e.error,required:e.required,"read-only":e.readOnly},{default:d(()=>[L(y("input",{name:e.name,ref_key:"input",ref:a,type:"text","onUpdate:modelValue":o[0]||(o[0]=s=>i.value=s),disabled:e.readOnly},null,8,We),[[k,i.value]])]),_:1},8,["label","error","required","read-only"]))}}),je=["name","disabled"],Je=h({__name:"InputJSON",props:{modelValue:{},label:{},error:{},name:{},required:{type:Boolean},readOnly:{type:Boolean},focus:{type:Boolean}},emits:["update:modelValue"],setup(r,{emit:l}){const t=r,n=l,a=v(),i=V({get:()=>t.modelValue,set:e=>{n("update:modelValue",e)}});return _(()=>{var e;t.focus&&((e=a.value)==null||e.focus())}),(e,o)=>(p(),c(I,{label:e.label,error:e.error,required:e.required,"read-only":e.readOnly},{default:d(()=>[L(y("textarea",{name:e.name,ref_key:"input",ref:a,"onUpdate:modelValue":o[0]||(o[0]=s=>i.value=s),disabled:e.readOnly},null,8,je),[[k,i.value]])]),_:1},8,["label","error","required","read-only"]))}}),Ke=["name","disabled"],Qe=h({__name:"InputPhone",props:{modelValue:{},label:{},error:{},name:{},required:{type:Boolean},readOnly:{type:Boolean},focus:{type:Boolean}},emits:["update:modelValue"],setup(r,{emit:l}){const t=r,n=l,a=v(),i=V({get:()=>t.modelValue,set:e=>{n("update:modelValue",e)}});return _(()=>{var e;t.focus&&((e=a.value)==null||e.focus())}),(e,o)=>(p(),c(I,{label:e.label,error:e.error,required:e.required,"read-only":e.readOnly},{default:d(()=>[L(y("input",{name:e.name,ref_key:"input",ref:a,type:"text","onUpdate:modelValue":o[0]||(o[0]=s=>i.value=s),disabled:e.readOnly},null,8,Ke),[[k,i.value]])]),_:1},8,["label","error","required","read-only"]))}}),Xe=["name","disabled"],Ye=h({__name:"InputConnection",props:{modelValue:{},label:{},error:{},name:{},required:{type:Boolean},readOnly:{type:Boolean},focus:{type:Boolean}},emits:["update:modelValue"],setup(r,{emit:l}){const t=r,n=l,a=v(),i=V({get:()=>t.modelValue,set:e=>{n("update:modelValue",e)}});return _(()=>{var e;t.focus&&((e=a.value)==null||e.focus())}),(e,o)=>(p(),c(I,{label:e.label,error:e.error,required:e.required,"read-only":e.readOnly},{default:d(()=>[L(y("input",{name:e.name,ref_key:"input",ref:a,type:"text","onUpdate:modelValue":o[0]||(o[0]=s=>i.value=s),disabled:e.readOnly},null,8,Xe),[[k,i.value]])]),_:1},8,["label","error","required","read-only"]))}}),Ze=h({__name:"EasyInput",props:{modelValue:{},field:{},error:{},focus:{type:Boolean},placeholder:{},noLabel:{type:Boolean}},emits:["update:modelValue"],setup(r,{emit:l}){const t={BigIntField:Te,BooleanField:Ue,ChoicesField:Ee,ConnectionField:Ye,DateField:Me,EmailField:Re,ImageField:Ge,IntField:we,JSONField:Je,MultiChoiceField:Ae,PasswordField:ge,PhoneField:Qe,TextField:Fe,DataField:W,IDField:W,TimestampField:_e},n=r;V(()=>{if("required"in n.field)return n.field.required}),V(()=>{if("readOnly"in n.field)return n.field.readOnly});const a=l,i=V({get:()=>n.modelValue,set:e=>{a("update:modelValue",e)}});return(e,o)=>(p(),c(ue(t[n.field.fieldType]),{modelValue:i.value,"onUpdate:modelValue":o[0]||(o[0]=s=>i.value=s),field:n.field,required:e.field.required,label:e.field.label,readOnly:e.field.readOnly,error:n.error,name:e.field.key,placeholder:e.placeholder,focus:n.focus,description:e.field.description,noLabel:n.noLabel},null,8,["modelValue","field","required","label","readOnly","error","name","placeholder","focus","description","noLabel"]))}}),xe={class:"title-3"},et=h({__name:"NewEntityForm",props:{entityDef:{}},emits:["close"],setup(r,{emit:l}){function t(){C("close")}async function n(){if(!i())return;await Z.createEntity(e.entityDef.entityId,o.value)&&t()}let a=[];function i(){let b=!0;return s.value={},a.forEach(w=>{o.value[w.key]||(s.value[w.key]="This field is required.",b=!1)}),b}const e=r,o=v({}),s=v({}),C=l;return j(b=>{b.key==="Escape"&&t(),b.key==="Enter"&&n()}),_(()=>{a=e.entityDef.fields.filter(b=>b.required),a.forEach(b=>{b.defaultValue&&(o.value[b.key]=b.defaultValue)})}),(b,w)=>(p(),c(z,{class:"row-gap-4"},{default:d(()=>[y("div",xe," New "+E(b.entityDef.label),1),y("form",{onSubmit:w[0]||(w[0]=A(()=>{},["prevent"]))},[m(B,{class:"col-2 row-gap-4 column-gap-3"},{default:d(()=>[(p(!0),P(T,null,S(b.entityDef.fields.filter(g=>g.required),(g,U)=>(p(),c(Ze,{focus:U==0,field:g,error:s.value[g.key],modelValue:o.value[g.key],"onUpdate:modelValue":D=>o.value[g.key]=D,key:g.key},null,8,["focus","field","error","modelValue","onUpdate:modelValue"]))),128))]),_:1})],32),m(B,{class:"col shrink horizontal-align-center"},{default:d(()=>[m(R,{onClick:t,icon:"close",color:"error",size:"1"}),m(R,{type:"submit",onClick:A(n,["prevent"]),icon:"check",color:"success",size:"1"})]),_:1})]),_:1}))}});class tt{constructor(){O(this,"initialized");O(this,"entity");O(this,"listInfo");O(this,"entityList");O(this,"isListLoading",!1);O(this,"listOptions");O(this,"easyApi");this.easyApi=Z,this.initialized=!1,this.entityList=v([]),this.listOptions={offset:0},this.listInfo={totalCount:v(0),itemsLoaded:v(0),itemsPerPage:0,listHeight:v(0),limitStart:0,resetScroll:v(!1),currentPage:1}}async init(l){var t;((t=this.entity)==null?void 0:t.entityId)==l.entityId&&(this.entityList.value=[],this.listOptions.columns=l.listFields,this.listOptions.orderBy=l.config.orderField||"updatedAt",this.listOptions.order=l.config.orderDirection||"desc",this.entity=l,this.initialized||(this.initialized=!0))}reset(){this.entityList.value=[],this.listInfo.totalCount.value=0,this.listInfo.itemsLoaded.value=0,this.listInfo.currentPage=1,this.listInfo.limitStart=0}async loadList(){if(!this.isListLoading){this.isListLoading=!0;const{data:l,columns:t,rowCount:n,totalCount:a}=await this.easyApi.getList(this.entity.entityId,{...this.listOptions,offset:this.listInfo.limitStart,limit:this.listInfo.itemsPerPage});this.entityList.value.push(...l),this.listInfo.totalCount.value=a,this.listInfo.itemsLoaded.value=n,this.isListLoading=!1,this.listInfo.resetScroll.value=!0}}async loadMore(l){if(!(this.listInfo.itemsLoaded.value>=this.listInfo.totalCount.value)&&!this.isListLoading){this.isListLoading=!0;const t=this.entityList.value.length,n=l-t+this.listInfo.itemsPerPage,{data:a,columns:i,rowCount:e,totalCount:o}=await this.easyApi.getList(this.entity.entityId,{...this.listOptions,offset:t,limit:n});this.entityList.value.push(...a),this.listInfo.totalCount.value=o,this.listInfo.itemsLoaded.value=this.entityList.value.length,this.listInfo.currentPage=Math.floor(this.entityList.value.length/this.listInfo.itemsPerPage),this.isListLoading=!1}}}const lt=h({__name:"TransitionList",props:{fade:{type:Boolean}},setup(r){return(l,t)=>(p(),c(de,{name:l.fade?"list-fade":"list"},{default:d(()=>[M(l.$slots,"default")]),_:3},8,["name"]))}}),at={class:"title-3"},ot={class:"position-relative"},nt={class:"label text-end"},it={class:"grid standard-grid-no-padding list-wrapper"},X=3,Y=60,rt=h({__name:"EntityList",props:{entity:{},activeEntity:{}},emits:["select"],setup(r,{emit:l}){pe(u=>({"3e7c4e96":U,"1c7fea37":b,"4a95af18":w.value}));const t=new tt,n=r,a=v(null);function i(){o.value=!0}function e(){o.value=!1}const o=v(!1);let s=[];me(async()=>{const u=he.entities.find(f=>f.entityId===n.entity);u&&(a.value=u,t.entity=u,s=u.listFields.filter(f=>!["id","createdAt","updatedAt",u.config.titleField].includes(f)))}),j(u=>{u.key==="n"&&(u.preventDefault(),i())}),be(n.entity,"list",async u=>{t.entityList.value.forEach((f,q)=>{f.id===u.id&&(t.entityList.value[q]=u)})});const C=fe("infinite"),b=`${X}px`,w=v("0"),g=Y+X,U=`${Y}px`;_(async()=>{var f;await t.init(a.value);const u=(f=C.value)==null?void 0:f.parentElement;u&&await K(u),window.addEventListener("resize",J),u==null||u.addEventListener("scroll",D)}),ce(()=>{var f;const u=(f=C.value)==null?void 0:f.parentElement;u==null||u.removeEventListener("scroll",D),window.removeEventListener("resize",J)});async function D(u){const q=u.currentTarget.scrollTop,$=Math.floor(q/g+t.listInfo.itemsPerPage);$+3>t.listInfo.itemsLoaded.value&&(await t.loadMore($),setTimeout(x,500))}async function x(){var q,$;const u=($=(q=C.value)==null?void 0:q.parentElement)==null?void 0:$.scrollTop;let f=Math.floor(u/g+t.listInfo.itemsPerPage);f>t.listInfo.totalCount.value&&(f=t.listInfo.totalCount.value),f>t.listInfo.itemsLoaded.value&&await t.loadMore(f)}async function J(){var u;await K((u=C.value)==null?void 0:u.parentElement)}async function K(u){const f=u.getBoundingClientRect(),q=Math.floor(f.height/g);t.listInfo.itemsPerPage=q*2,u.scrollTop=0,t.reset(),await t.loadList(),w.value=`${t.listInfo.totalCount.value*g}px`}return(u,f)=>(p(),c(z,{class:"entity-list-wrapper"},{default:d(()=>{var q;return[y("div",at,E((q=a.value)==null?void 0:q.config.label),1),m(G,null,{default:d(()=>[m(B,{class:"list-header col horizontal-align-between"},{default:d(()=>[y("div",ot,[m(W,{name:"search",placeholder:"Search",focus:""}),m(H,{class:"position-absolute right pe-2 center-y",size:"1.2",icon:"search"})]),y("div",null,[m(R,{label:`New ${u.entity}`,onClick:i,icon:"add",size:"1"},null,8,["label"])])]),_:1})]),_:1}),y("div",nt," Loaded "+E(F(t).listInfo.itemsLoaded)+" of "+E(F(t).listInfo.totalCount)+" records ",1),y("div",it,[y("div",{ref_key:"infinite",ref:C,class:"grid standard-grid-no-padding list-container row infinite overflow-hidden"},[m(lt,{fade:""},{default:d(()=>[(p(!0),P(T,null,S(F(t).entityList.value,$=>(p(),c($e,{active:u.activeEntity==$.id,key:$.id,entityDef:a.value,fields:F(s),record:$,onSelect:f[0]||(f[0]=ee=>u.$emit("select",ee))},null,8,["active","entityDef","fields","record"]))),128))]),_:1})],512)]),m(Be,{modelValue:o.value,"onUpdate:modelValue":f[1]||(f[1]=$=>o.value=$)},{default:d(()=>[m(et,{entityDef:F(t).entity,onClose:e},null,8,["entityDef"])]),_:1},8,["modelValue"])]}),_:1}))}}),st=h({__name:"EntityListView",props:{entity:{},id:{}},setup(r){const l=r;return(t,n)=>(p(),c(Le,{maxWidth:"400px"},{list:d(()=>[m(rt,{entity:t.entity,activeEntity:t.id,onSelect:n[0]||(n[0]=a=>t.$router.push(`/entity/${t.entity}/${a}`))},null,8,["entity","activeEntity"])]),detail:d(()=>[(p(),c(Ve,{key:l.id}))]),_:1}))}}),vt=ye(st,[["__scopeId","data-v-94f965b8"]]);export{vt as default};
