import{C as z}from"./CardWidget-BgBev2dT.js";import{d as w,a as g,x as S,o as n,c as u,w as t,e as v,b as e,p as h,z as E,F as D,C as d,s as A,t as $,h as V,n as q,B as N,l as b,f as L,m as T,v as R,J as x,K as G,L as K,q as W,g as j,j as J,i as F,A as O}from"./index-CQnUWCV4.js";import{_ as H}from"./LoaderOverlay.vue_vue_type_style_index_0_lang-BQsvPLa7.js";import{_ as C,a as P,M as B}from"./ButtonIcon.vue_vue_type_script_setup_true_lang-CsaDcWkB.js";import{_ as Q,f as X,l as Y,o as Z,a as ee,g as te}from"./index-Hw269v-C.js";import{_ as le}from"./FormBase.vue_vue_type_script_setup_true_lang-g0x0dRxx.js";import{_ as I,d as ae,a as se}from"./EasyInput.vue_vue_type_script_setup_true_lang-DE1NCTWD.js";import{a as oe}from"./index-Bc1H_-TJ.js";import"./Button.vue_vue_type_script_setup_true_lang-1s5_nbt9.js";import"./InputData.vue_vue_type_script_setup_true_lang-DzXQy-iL.js";const re={class:"title-5 text-accent"},ie={class:"text-small italic"},ne={class:"title-4 text-center"},de=w({__name:"EntityActions",props:{entityDef:{},record:{}},setup(_){const s=_,r=g([]),l=g({key:"",label:"",description:"",params:[],action:()=>{}}),i=g({}),a=g(!1);S(()=>{r.value=s.entityDef.actions.filter(f=>!f.private)});async function y(f){if(l.value=f,f.params&&f.params.length>0){i.value={},f.params.forEach(c=>{i.value[c.key]={error:"",value:null}}),a.value=!0;return}await p(f)}async function p(f){if(!M(f,i.value))return;const c={};for(const m in i.value)c[m]=i.value[m].value;const o=await V.runEntityAction(s.entityDef.entityId,s.record.id,f.key,c);q({title:`Action ${f.label||f.key} completed`,message:o.message||o||"Action completed",type:"success"}),i.value={},l.value={key:"",label:"",description:"",params:[],action:()=>{}},a.value=!1}function M(f,c){let o=!1;if(!f.params)return!0;for(const m of f.params){if(m.required&&!c[m.key].value){c[m.key].error="Please provide a value",o=!0;continue}c[m.key].error=""}return!o}return(f,c)=>(n(),u(A,{class:"row shrink"},{default:t(()=>[c[3]||(c[3]=v("div",null,[v("div",{class:"title-4"},"Actions")],-1)),e(d,{class:"row shrink"},{default:t(()=>[(n(!0),h(D,null,E(r.value,o=>(n(),u(z,{key:o.key},{default:t(()=>[e(d,{class:"col-2 shrink vertical-align-center"},{default:t(()=>[e(C,{icon:"play_arrow",color:"secondary",onClick:m=>y(o),label:o.label,key:"play"},null,8,["onClick","label"]),e(d,null,{default:t(()=>[v("div",re,$(o.label),1),v("div",ie,$(o.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),e(Q,{modelValue:a.value,"onUpdate:modelValue":c[2]||(c[2]=o=>a.value=o)},{default:t(()=>[e(A,{class:"row row-gap-4"},{default:t(()=>[v("div",ne,$(l.value.label||l.value.key),1),e(le,{name:"actionParamsForm",onSubmitted:c[1]||(c[1]=async()=>await p(l.value))},{default:t(()=>[e(d,{class:"row row-gap-4"},{default:t(()=>[e(d,null,{default:t(()=>[(n(!0),h(D,null,E(l.value.params,o=>(n(),h("div",{key:o.key},[(n(),u(N(b(X)[o.fieldType]),{label:o.key,required:o.required,error:i.value[o.key].error,modelValue:i.value[o.key].value,"onUpdate:modelValue":m=>i.value[o.key].value=m},null,8,["label","required","error","modelValue","onUpdate:modelValue"]))]))),128))]),_:1}),e(d,{class:"col shrink horizontal-align-center gap-3"},{default:t(()=>[e(C,{icon:"cancel",color:"error",onClick:c[0]||(c[0]=o=>a.value=!1),label:"Cancel"}),e(C,{icon:"play_arrow",type:"submit",color:"secondary",label:l.value.label},null,8,["label"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),ue=w({__name:"EntityInfo",props:{entityDef:{},record:{}},setup(_){return(s,r)=>(n(),u(d,null,{default:t(()=>[e(d,{class:"col"},{default:t(()=>[r[0]||(r[0]=v("div",{class:"label"},"Created At:",-1)),e(I,{class:"label text-info-dark",value:s.record.createdAt},null,8,["value"])]),_:1}),e(d,{class:"col"},{default:t(()=>[r[1]||(r[1]=v("div",{class:"label"},"Last Updated:",-1)),e(I,{class:"label text-info-dark",value:s.record.updatedAt},null,8,["value"])]),_:1})]),_:1}))}}),ce=w({__name:"EntityToolbar",props:{editMode:{type:Boolean}},emits:["edit","save","delete"],setup(_,{emit:s}){const r=s,l=_;return Y(i=>{Z(i,()=>{l.editMode&&r("save")})}),(i,a)=>(n(),u(d,{class:"toolbar col shrink"},{default:t(()=>[e(P,{speed:"fast"},{default:t(()=>[i.editMode?(n(),u(C,{key:0,icon:"save",size:"1",color:"success",onClick:a[0]||(a[0]=y=>i.$emit("save"))})):L("",!0)]),_:1}),e(P,{speed:"fast"},{default:t(()=>[i.editMode?(n(),u(C,{key:0,onClick:a[1]||(a[1]=y=>i.$emit("delete")),icon:"delete",size:"1",color:"error"})):L("",!0)]),_:1}),e(C,{onClick:a[2]||(a[2]=y=>i.$emit("edit",!i.editMode)),icon:i.editMode?"edit_off":"edit",label:"Edit Mode",color:"warning",size:"1"},null,8,["icon"])]),_:1}))}}),fe={class:"label"},pe=w({__name:"DisplayFieldWrapper",props:{field:{},direction:{}},setup(_){return(s,r)=>(n(),u(d,{class:R({horizontal:s.direction==="horizontal",vertical:s.direction==="vertical"})},{default:t(()=>[v("div",fe,$(s.field.label),1),v("div",null,[T(s.$slots,"default")])]),_:3},8,["class"]))}}),ve=w({__name:"DisplayField",props:{value:{},field:{},direction:{},titleValue:{},format:{},routePrefix:{}},setup(_){const s=_;return(r,l)=>(n(),u(pe,{field:r.field},{default:t(()=>[(n(),u(N(b(ae)[s.field.fieldType]),x(G(s)),null,16))]),_:1},8,["field"]))}}),ye={class:"title-4 text-primary"},U=w({__name:"EntityFieldGroup",props:{group:{},edit:{type:Boolean},record:{}},setup(_){const s=_,r=K(()=>s.group.fields.filter(l=>{var i;return!(l.hidden||(i=l.fetchOptions)!=null&&i.thisIdKey)}));return(l,i)=>(n(),u(z,{class:""},{default:t(()=>[e(d,{class:"row shrink"},{default:t(()=>[v("div",ye,$(l.group.title),1),e(d,{class:R(["group-fields col shrink column-gap-3 overflow-hidden",{edit:l.edit}])},{default:t(()=>[e(d,{class:"col-2 field-values"},{default:t(()=>[(n(!0),h(D,null,E(r.value,a=>(n(),u(d,{key:`${a.key}value`},{default:t(()=>[l.edit?(n(),u(se,{key:0,field:a,modelValue:l.record[a.key],"onUpdate:modelValue":y=>l.record[a.key]=y},null,8,["field","modelValue","onUpdate:modelValue"])):(n(),u(ve,{key:1,value:l.record[a.key],field:a,format:"date",routePrefix:`/entity/${a.connectionEntity}`},null,8,["value","field","routePrefix"]))]),_:2},1024))),128))]),_:1})]),_:1},8,["class"])]),_:1})]),_:1}))}}),me={class:"time italic"},_e=w({__name:"EntityEditLog",props:{editLog:{}},setup(_){const s={create:"created",update:"updated",delete:"deleted"},r=g(),l=g(!1);return(i,a)=>{const y=W("RouterLink");return n(),u(d,{class:"edit-log row shrink gap-3 position-relative"},{default:t(()=>[a[1]||(a[1]=v("div",{class:"title-5"},"Edit Log",-1)),e(A,{class:"edit-log-container row shrink gap-3"},{default:t(()=>[(n(!0),h(D,null,E(i.editLog,p=>(n(),u(d,{class:"edit-log-entry col shrink text-small",key:p.id},{default:t(()=>[v("div",me,$(b(te)(p.createdAt,{format:"pretty"})),1),e(y,{class:"user-link",to:`/entity/user/${p.user}`},{default:t(()=>[j($(p.userFullName),1)]),_:2},1032,["to"]),v("div",{class:R(p.action)},$(s[p.action]),3),v("div",null,$(p.recordTitle||p.recordId),1),e(B,{class:"cursor-pointer",icon:"info",onClick:M=>{r.value=p,l.value=!0}},null,8,["onClick"])]),_:2},1024))),128))]),_:1}),r.value&&l.value?(n(),u(d,{key:0,class:"position-absolute w-100 h-100 top left row shrink"},{default:t(()=>{var p;return[e(B,{class:"cursor-pointer horizontal-align-self-end",icon:"close",onClick:a[0]||(a[0]=M=>l.value=!1)}),e(ee,{value:(p=r.value)==null?void 0:p.editData},null,8,["value"])]}),_:1})):L("",!0)]),_:1})}}}),ke={class:"title-4"},ge={class:"text-small italic text-primary-bright"},Le=w({__name:"EntityRecordView",props:{entity:{},id:{}},setup(_){const s=_;let r={};const l=g({}),i=g({editLog:[]}),a={loaded:g(!1),saving:g(!1)},y=g(!1);async function p(){a.loaded.value=!1,l.value=await V.getEntity(s.entity,s.id),a.loaded.value=!0}async function M(){i.value=await V.getRecordInfo(s.entity,s.id)}async function f(){if(!l.value)return;a.saving.value=!0;const o=l.value;await V.updateEntity(s.entity,o.id,o),a.saving.value=!1}async function c(){l.value&&(a.saving.value=!0,await V.deleteEntity(s.entity,l.value.id),a.saving.value=!1,await F.push(`/entity/${s.entity}`))}return oe(s.entity,"update",async o=>{o.id===s.id&&(l.value=o,q({message:`${r.config.label} ${l.value[r.config.titleField||"id"]} was updated`,title:`${r.config.label} Updated`,type:"success"}))}),J(()=>{if(!s.id||!s.entity)return F.push("/entity");const o=O.getDef(s.entity);if(!o)return F.push("/entity");r=o}),S(async()=>{await p(),await M()}),(o,m)=>(n(),u(P,null,{default:t(()=>[a.loaded.value?(n(),u(A,{key:0,class:"position-relative entity-record-grid"},{default:t(()=>[e(d,{class:"top-bar col shrink vertical-align-center horizontal-align-between"},{default:t(()=>[e(d,null,{default:t(()=>[v("div",ke,$(l.value[b(r).config.titleField||"id"]),1),v("div",ge,$(l.value.id),1)]),_:1}),e(ce,{editMode:y.value,onSave:f,onDelete:c,onEdit:m[0]||(m[0]=k=>y.value=k)},null,8,["editMode"])]),_:1}),e(A,{class:"fields"},{default:t(()=>[e(d,{class:"row shrink"},{default:t(()=>[(n(!0),h(D,null,E(b(r).fieldGroups.filter(k=>k.key!=="default"),k=>(n(),u(U,{edit:y.value,group:k,record:l.value,key:k.key},null,8,["edit","group","record"]))),128)),(n(!0),h(D,null,E(b(r).fieldGroups.filter(k=>k.key==="default"),k=>(n(),u(U,{edit:y.value,group:k,record:l.value,key:k.key},null,8,["edit","group","record"]))),128))]),_:1})]),_:1}),e(d,{class:"info"},{default:t(()=>[e(ue,{entityDef:b(r),record:l.value},null,8,["entityDef","record"])]),_:1}),e(d,{class:"actions"},{default:t(()=>[e(de,{entityDef:b(r),record:l.value},null,8,["entityDef","record"])]),_:1}),e(d,{class:"editLog vertical-align-end"},{default:t(()=>[e(z,{class:"h-100"},{default:t(()=>[e(_e,{"edit-log":i.value.editLog},null,8,["edit-log"])]),_:1})]),_:1}),e(H,{loaded:!a.saving.value},null,8,["loaded"])]),_:1})):L("",!0)]),_:1}))}});export{Le as default};
