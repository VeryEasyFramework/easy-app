import{C as L}from"./CardWidget-CEgwpWs7.js";import{d as _,n as w,q as T,o as a,c as m,w as n,b as g,a as l,i as c,v as D,F as C,C as p,l as E,t as d,B as x,I as q,z as N,m as b,j as M,p as S,k as G,e as j,g as J,f as I,x as K}from"./index-BIuYyD81.js";import{_ as O}from"./LoaderOverlay.vue_vue_type_style_index_0_lang-D-DXIXuk.js";import{_ as F,a as V,M as B}from"./ButtonIcon.vue_vue_type_script_setup_true_lang-mKvY9iEi.js";import{_ as W,i as H,l as Q,o as X,a as Y,g as Z}from"./index-DVjfnBu1.js";import{_ as ee}from"./FormBase.vue_vue_type_script_setup_true_lang-Bg5RzrFO.js";import{_ as P}from"./DisplayTimestamp.vue_vue_type_script_setup_true_lang-CwZkgo9L.js";import{a as te}from"./index-Dec2nNcQ.js";import{_ as U}from"./DisplayJSON.vue_vue_type_style_index_0_lang-DJE9avWq.js";import"./InputPassword.vue_vue_type_script_setup_true_lang-DzxX9jck.js";const le={class:"title-5 text-accent"},ae={class:"text-small italic"},se={class:"title-4 text-center"},ne=_({__name:"EntityActions",props:{entityDef:{},record:{}},setup(i){const e=i,s=w([]),t=w({key:"",label:"",description:"",params:[],action:()=>{}}),u=w({}),r=w(!1);T(()=>{s.value=e.entityDef.actions.filter(v=>!v.private)});async function $(v){if(t.value=v,v.params&&v.params.length>0){u.value={},v.params.forEach(f=>{u.value[f.key]={error:"",value:null}}),r.value=!0;return}await y(v)}async function y(v){if(!A(v,u.value))return;const f={};for(const k in u.value)f[k]=u.value[k].value;const o=await x.runEntityAction(e.entityDef.entityId,e.record.id,v.key,f);q({title:`Action ${v.label||v.key} completed`,message:o.message||o||"Action completed",type:"success"}),u.value={},t.value={key:"",label:"",description:"",params:[],action:()=>{}},r.value=!1}function A(v,f){let o=!1;if(!v.params)return!0;for(const k of v.params){if(k.required&&!f[k.key].value){f[k.key].error="Please provide a value",o=!0;continue}f[k.key].error=""}return!o}return(v,f)=>(a(),m(E,{class:"row shrink"},{default:n(()=>[f[3]||(f[3]=g("div",null,[g("div",{class:"title-4"},"Actions")],-1)),l(p,{class:"row shrink"},{default:n(()=>[(a(!0),c(C,null,D(s.value,o=>(a(),m(L,{key:o.key},{default:n(()=>[l(p,{class:"col-2 shrink vertical-align-center"},{default:n(()=>[l(F,{icon:"play_arrow",color:"secondary",onClick:k=>$(o),label:o.label,key:"play"},null,8,["onClick","label"]),l(p,null,{default:n(()=>[g("div",le,d(o.label),1),g("div",ae,d(o.description),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),l(W,{modelValue:r.value,"onUpdate:modelValue":f[2]||(f[2]=o=>r.value=o)},{default:n(()=>[l(E,{class:"row row-gap-4"},{default:n(()=>[g("div",se,d(t.value.label||t.value.key),1),l(ee,{name:"actionParamsForm",onSubmitted:f[1]||(f[1]=async()=>await y(t.value))},{default:n(()=>[l(p,{class:"row row-gap-4"},{default:n(()=>[l(p,null,{default:n(()=>[(a(!0),c(C,null,D(t.value.params,o=>(a(),c("div",{key:o.key},[(a(),m(N(b(H)[o.fieldType]),{label:o.key,required:o.required,error:u.value[o.key].error,modelValue:u.value[o.key].value,"onUpdate:modelValue":k=>u.value[o.key].value=k},null,8,["label","required","error","modelValue","onUpdate:modelValue"]))]))),128))]),_:1}),l(p,{class:"col shrink horizontal-align-center gap-3"},{default:n(()=>[l(F,{icon:"cancel",color:"error",onClick:f[0]||(f[0]=o=>r.value=!1),label:"Cancel"}),l(F,{icon:"play_arrow",type:"submit",color:"secondary",label:t.value.label},null,8,["label"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}}),ie=_({__name:"EntityInfo",props:{entityDef:{},record:{}},setup(i){return(e,s)=>(a(),m(p,null,{default:n(()=>[l(p,{class:"col"},{default:n(()=>[s[0]||(s[0]=g("div",{class:"label"},"Created At:",-1)),l(P,{class:"label text-info-dark",value:e.record.createdAt},null,8,["value"])]),_:1}),l(p,{class:"col"},{default:n(()=>[s[1]||(s[1]=g("div",{class:"label"},"Last Updated:",-1)),l(P,{class:"label text-info-dark",value:e.record.updatedAt},null,8,["value"])]),_:1})]),_:1}))}}),oe=_({__name:"EntityToolbar",props:{editMode:{type:Boolean}},emits:["edit","save","delete"],setup(i,{emit:e}){const s=e,t=i;return Q(u=>{X(u,()=>{t.editMode&&s("save")})}),(u,r)=>(a(),m(p,{class:"toolbar col shrink"},{default:n(()=>[l(V,{speed:"fast"},{default:n(()=>[u.editMode?(a(),m(F,{key:0,icon:"save",size:"1",color:"success",onClick:r[0]||(r[0]=$=>u.$emit("save"))})):M("",!0)]),_:1}),l(V,{speed:"fast"},{default:n(()=>[u.editMode?(a(),m(F,{key:0,onClick:r[1]||(r[1]=$=>u.$emit("delete")),icon:"delete",size:"1",color:"error"})):M("",!0)]),_:1}),l(F,{onClick:r[2]||(r[2]=$=>u.$emit("edit",!u.editMode)),icon:u.editMode?"edit_off":"edit",label:"Edit Mode",color:"warning",size:"1"},null,8,["icon"])]),_:1}))}}),z=_({__name:"DisplayData",props:{value:{},field:{}},setup(i){const e=i;return(s,t)=>(a(),c("div",null,d(e.value),1))}}),re=_({__name:"DisplayInt",props:{value:{},field:{}},setup(i){const e=i;return(s,t)=>(a(),c("div",null,d(e.value),1))}}),ue=_({__name:"DisplayBigInt",props:{value:{},field:{}},setup(i){const e=i;return(s,t)=>(a(),c("div",null,d(e.value),1))}}),de=_({__name:"DisplayDate",props:{value:{},field:{}},setup(i){const e=i;return(s,t)=>(a(),c("div",null,d(e.value),1))}}),ce=_({__name:"DisplayBoolean",props:{value:{},field:{}},setup(i){const e=i;return(s,t)=>(a(),c("div",null,d(e.value),1))}}),pe=_({__name:"DisplayPassword",props:{value:{},field:{}},setup(i){const e=i;return(s,t)=>(a(),c("div",null,d(e.value),1))}}),fe=_({__name:"DisplayChoices",props:{value:{},field:{}},setup(i){const e=i;return(s,t)=>(a(),c("div",null,d(e.value),1))}}),_e=_({__name:"DisplayMultiChoice",props:{value:{},field:{}},setup(i){const e=i;return(s,t)=>(a(),c("div",null,d(e.value),1))}}),ve=_({__name:"DisplayText",props:{value:{},field:{}},setup(i){const e=i;return(s,t)=>(a(),c("div",null,d(e.value),1))}}),me=_({__name:"DisplayEmail",props:{value:{},field:{}},setup(i){const e=i;return(s,t)=>(a(),c("div",null,d(e.value),1))}}),ye=_({__name:"DisplayImage",props:{value:{},field:{}},setup(i){const e=i;return(s,t)=>(a(),c("div",null,d(e.value),1))}}),ge=_({__name:"DisplayPhone",props:{value:{},field:{}},setup(i){const e=i;return(s,t)=>(a(),c("div",null,d(e.value),1))}}),ke=_({__name:"DisplayConnection",props:{value:{},field:{},titleValue:{}},setup(i){return(e,s)=>(a(),c("div",null,d(e.titleValue),1))}}),$e={IDField:z,DataField:z,IntField:re,BigIntField:ue,DateField:de,BooleanField:ce,PasswordField:pe,ChoicesField:fe,MultiChoiceField:_e,TextField:ve,EmailField:me,ImageField:ye,JSONField:U,PhoneField:ge,ConnectionField:ke,TimestampField:Y},he={class:"title-4 text-primary"},we={class:"text-small align-content-center bold"},be={class:"text-medium align-content-center"},R=_({__name:"EntityFieldGroup",props:{group:{},edit:{type:Boolean},record:{}},setup(i){return(e,s)=>(a(),m(L,null,{default:n(()=>[l(p,{class:"row shrink"},{default:n(()=>[g("div",he,d(e.group.title),1),l(E,{class:S(["group-fields column-gap-3",{edit:e.edit}])},{default:n(()=>[l(p,{class:"field-names"},{default:n(()=>[(a(!0),c(C,null,D(e.group.fields.filter(t=>!t.hidden),t=>(a(),c("div",we,d(t.label),1))),256))]),_:1}),l(p,{class:"row field-values"},{default:n(()=>[(a(!0),c(C,null,D(e.group.fields,t=>(a(),c("div",be,[e.edit?M("",!0):(a(),m(N(b($e)[t.fieldType]),{key:0,field:t,value:e.record[t.key]},null,8,["field","value"]))]))),256))]),_:1})]),_:1},8,["class"])]),_:1})]),_:1}))}}),De={class:"time italic"},Ce=_({__name:"EntityEditLog",props:{editLog:{}},setup(i){const e={create:"created",update:"updated",delete:"deleted"},s=w(),t=w(!1);return(u,r)=>{const $=G("RouterLink");return a(),m(p,{class:"edit-log row shrink gap-3 position-relative"},{default:n(()=>[r[1]||(r[1]=g("div",{class:"title-5"},"Edit Log",-1)),l(E,{class:"edit-log-container row shrink gap-3"},{default:n(()=>[(a(!0),c(C,null,D(u.editLog,y=>(a(),m(p,{class:"edit-log-entry col shrink text-small",key:y.id},{default:n(()=>[g("div",De,d(b(Z)(y.createdAt,{format:"pretty"})),1),l($,{class:"user-link",to:`/entity/user/${y.user}`},{default:n(()=>[j(d(y.userFullName),1)]),_:2},1032,["to"]),g("div",{class:S(y.action)},d(e[y.action]),3),g("div",null,d(y.recordTitle||y.recordId),1),l(B,{class:"cursor-pointer",icon:"info",onClick:A=>{s.value=y,t.value=!0}},null,8,["onClick"])]),_:2},1024))),128))]),_:1}),s.value&&t.value?(a(),m(p,{key:0,class:"position-absolute w-100 h-100 top left row shrink"},{default:n(()=>[l(B,{class:"cursor-pointer horizontal-align-self-end",icon:"close",onClick:r[0]||(r[0]=y=>t.value=!1)}),l(U,{value:s.value},null,8,["value"])]),_:1})):M("",!0)]),_:1})}}}),Fe={class:"title-4"},Ee={class:"text-small italic text-primary-bright"},Te=_({__name:"EntityRecordView",props:{entity:{},id:{}},setup(i){const e=i;let s={};const t=w({}),u=w({editLog:[]}),r={loaded:w(!1),saving:w(!1)},$=w(!1);async function y(){r.loaded.value=!1,t.value=await x.getEntity(e.entity,e.id),r.loaded.value=!0}async function A(){u.value=await x.getRecordInfo(e.entity,e.id)}async function v(){if(!t.value)return;r.saving.value=!0;const o=t.value;await x.updateEntity(e.entity,o.id,o),r.saving.value=!1}async function f(){t.value&&(r.saving.value=!0,await x.deleteEntity(e.entity,t.value.id),r.saving.value=!1,await I.push(`/entity/${e.entity}`))}return te(e.entity,"update",async o=>{o.id===e.id&&(t.value=o,q({message:`${s.config.label} ${t.value[s.config.titleField||"id"]} was updated`,title:`${s.config.label} Updated`,type:"success"}))}),J(()=>{if(!e.id||!e.entity)return I.push("/entity");const o=K.getDef(e.entity);if(!o)return I.push("/entity");s=o}),T(async()=>{await y(),await A()}),(o,k)=>(a(),m(V,null,{default:n(()=>[r.loaded.value?(a(),m(E,{key:0,class:"position-relative entity-record-grid"},{default:n(()=>[l(p,{class:"top-bar col shrink vertical-align-center horizontal-align-between"},{default:n(()=>[l(p,null,{default:n(()=>[g("div",Fe,d(t.value[b(s).config.titleField||"id"]),1),g("div",Ee,d(t.value.id),1)]),_:1}),l(oe,{editMode:$.value,onSave:v,onDelete:f,onEdit:k[0]||(k[0]=h=>$.value=h)},null,8,["editMode"])]),_:1}),l(E,{class:"fields"},{default:n(()=>[l(p,{class:"row shrink"},{default:n(()=>[(a(!0),c(C,null,D(b(s).fieldGroups.filter(h=>h.key!=="default"),h=>(a(),m(R,{edit:$.value,group:h,record:t.value,key:h.key},null,8,["edit","group","record"]))),128)),(a(!0),c(C,null,D(b(s).fieldGroups.filter(h=>h.key==="default"),h=>(a(),m(R,{edit:$.value,group:h,record:t.value,key:h.key},null,8,["edit","group","record"]))),128))]),_:1})]),_:1}),l(p,{class:"info"},{default:n(()=>[l(ie,{entityDef:b(s),record:t.value},null,8,["entityDef","record"])]),_:1}),l(p,{class:"actions"},{default:n(()=>[l(ne,{entityDef:b(s),record:t.value},null,8,["entityDef","record"])]),_:1}),l(p,{class:"editLog vertical-align-end"},{default:n(()=>[l(L,{class:"h-100"},{default:n(()=>[l(Ce,{"edit-log":u.value.editLog},null,8,["edit-log"])]),_:1})]),_:1}),l(O,{loaded:!r.saving.value},null,8,["loaded"])]),_:1})):M("",!0)]),_:1}))}});export{Te as default};
